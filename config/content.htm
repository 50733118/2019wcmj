<h1>簡介</h1>
<p>在網際內容管理這門課,主要目的是學習到如何創建一個個人github倉儲,並用可攜式系統使用SSH上傳資料至個人網站,以及更新倉儲</p>
<p><strong>在這門課學習到的相關資料</strong>:</p>
<p><strong>網路連線設定</strong></p>
<p><strong>配置可攜程式環境</strong></p>
<p><strong>倉儲改版</strong></p>
<p><strong>靜態 CMSimfly</strong></p>
<p><strong>Mobile 網站內容</strong></p>
<h1>我的Github倉儲</h1>
<p>網址:<a href="https://github.com/50733118/2019wcmj">https://github.com/50733118/2019wcmj</a></p><h1>課程相關資料</h1>
<p>本資料來源:<a href="http://cpgx.kmol.info/wcm2019/content/index.html">http://cpgx.kmol.info/wcm2019/content/index.html</a></p>
<h2>網路連線設定</h2>
<p><span>了解機械設計系電腦輔助設計室電腦的網路設定, 其中包括 IPv4 網路與 IPv6 網路設定.</span><br/><br/><span>正常情況下, 電腦輔助設計室中的 64 台電腦透過 IPv4 協定下的 DHCP 與 NAT 上網, 各電腦以 DHCP client 取得 192.168.1.* 的網路位址, 然後以 NAT 的一組外部 IP 上網, 通常必須設定 Proxy Server 為 http://proxy.kmol.info:3128 後上網會比較順暢, 但若 8 台 Proxy Servers 無法正常運作時, 則取消 Proxy Server 的設定.</span><br/><br/><span>瀏覽器代理主機設定</span><br/><br/><span>了解如何設定 Google Chrome 與 Firefox 瀏覽器的代理主機設定.</span><br/><br/><span>申請 Github 帳號</span><br/><br/><span>利用 Gmail 帳號申請 Github 帳號, 申請後利用電子郵箱收信進行確認後, 就可以在 Github 上建立倉儲.</span></p>
<h2>配置可攜式環境</h2>
<p><span>取得 Windows 10 64 位元環境下的可攜程式環境 (下載  2019_cdb_w5.7z), 下載後解開目錄, 放入 USB3.0 規格以上的隨身碟或隨身硬碟.<br/><br/><span>以滑鼠點擊 start.bat 開啟可攜隨身系統, 以 stop.bat 關閉可攜隨身系統, 隨身碟必須在關閉所有應用程式執行下, 才可正常退出.</span><br/><br/><span>了解基本的 DOS (Disk Operating System) 指令</span><br/><br/><span>C:\&gt; 符號為 DOS 命令列視窗的回應 (Prompt), 表示目前在 C 槽硬碟的 \ 根目錄, 若要切換到 Y 槽, 則在電腦的回應後, 輸入 Y:, 命令列將轉為</span><br/><br/><span>Y:\&gt;</span><br/><br/><span>若要更換目錄, 則使用 cd, 也就是 change directory 的意思, 例如:</span><br/><br/><span>Y:\&gt;cd tmp</span><br/><br/><span>表示要從 Y 槽的根目錄更換到 tmp 目錄, 也就是</span><br/><br/><span>Y:\tmp&gt;</span><br/><br/><span>若要再回到 Y 槽的根目錄, 可以使用 cd ..</span><br/><br/><span>表示要從目前所在目錄, 往上跳回一個目錄, 也就是重新回到 Y 槽的根目錄.</span><br/><br/><span>另外, 無論目前位於哪一個子目錄, 也可以使用 cd \</span><br/><br/><span>直接回到根目錄.</span><br/><br/><span>或者從 Y:\&gt; 直接使用</span><br/><br/><span>cd \tmp\repo\ssh\wcm2019</span><br/><br/><span>直接從 Y 槽的根目錄, 跳進 Y:\tmp\repo\ssh\wcm2019&gt;</span><br/><br/><span>此外, 常用的 DOS 指令有:</span><br/><br/><span>dir - 列出目前所在目錄的內容</span><br/><br/><span>mkdir - 隨後加上要建立目錄的名稱, 可以建立目錄</span><br/><br/><span>cls - clear screen, 清除目前的命令列顯示的內容</span></span></p>
<h2>倉儲改版</h2>
<p>建立 Git 倉儲, 並 clone 倉儲至近端工作後, 對遠端倉儲改版<br/><br/>可攜程式系統中已經內建 git, 可以在啟動 start.bat 後, 透過 path 的設定, 直接執行 git 指令.<br/><br/>建立 Git 倉儲, 共分為兩類, 一類是直接在 Github 網際介面下建立倉儲時, 要求建立 README.md 檔案, 之後可以直接在近端, 以 git clone 加上倉儲連線 URL, 將倉儲克隆一份到近端, 並以最新版本作為工作目錄, 使用者改版後, 可以直接透過 git add, commit 與 push 對遠端倉儲改版.<br/><br/>另一類則是故意在 Github 網際介面下建立倉儲時, 不要建立任何檔案, 而是在近端自行利用 git 指令建立倉儲架構, 新增內容後, 以 git remote add 設法在近端倉儲中納入 origin URL 後, 將近端倉儲版本新增提交推送到遠端.<br/><br/>git add<br/><br/>git add 可以用來新增一個檔案, 數個檔案, 或在之前提交後所新增的所有內容.<br/><br/>git add 在 GIT 架構下, 是對所新增或修改的內容拍快照:<br/><br/>git add . adds all modified and new (untracked) files in the current directory and all subdirectories to the staging area (a.k.a. the index), thus preparing them to be included in the next git commit . Any files matching the patterns in the .gitignore file will be ignored by git add<br/><br/>git commit<span> </span><br/><br/>git commit 執行之前, 必須使用 git config 建立臨時或永久的身分註記, 因為 GIT 在展開所有改版內容時, 必須明確登錄這些變更的作者與時間.<br/><br/>當使用者採用 git commit -m "改版說明訊息", 此次提交到 .git 目錄下的更動內容, 均會綁定使用者身分與改版所輸入的說明訊息.<br/><br/>git push<br/><br/>git push 在隨後沒有輸入遠端 URL 代號時, 表示要推送到 origin, 若透過 git remote add 設定其他代號與 URL 對應時, git push 加上代號, 就可以將此次的提交內容, 推送到指定的 URL 所在遠端倉儲.</p>
<p><br/><br/><br/><span>靜態 CMSimfly</span></p>
<p>利用 CMSimfly (https://github.com/chiamingyen/cmsimfly) 內容, 建立自己的 Github Pages 網站<br/><br/>設法利用<span> </span><a href="http://mde.tw/wcm2019/content/%E5%AF%A6%E7%BF%92%E9%A0%85%E7%9B%AE%E4%B8%89.html">HTML5 CSS 與 Javascript</a>, 納入與機械設計相關的靜態網頁內容</p>
<h2>Moblie網站內容</h2>
<p>參考倉儲:<span> </span><a href="https://github.com/mdecourse/acmsimfly">https://github.com/mdecourse/acmsimfly</a></p>
<p>參考網站:</p>
<p><a href="http://mde.tw/acmsimfly">http://mde.tw/acmsimfly</a></p>
<p><a href="https://github.com/BlackrockDigital">https://github.com/BlackrockDigital</a></p>
<p><a href="https://themewagon.com/theme_tag/bootstrap-4-templates/">https://themewagon.com/theme_tag/bootstrap-4-templates/</a></p>
<p><a href="https://github.com/kamranahmedse/developer-roadmap">https://github.com/kamranahmedse/developer-roadmap</a> (<a href="https://medium.com/tech-tajawal/modern-frontend-developer-in-2018-4c2072fa2b9c">blog</a>)</p>
<p><br/>學習如何使用 CMSimfly, 在網站中加入各種內容 (導入 Bootstrap frontend framework)<br/><br/>使用 Flask, bs4 與 lxml 模組<br/><br/>了解 CMSimfly 如何建構, 並且嘗試修改現有功能, 除錯或建立自己的網際內容管理系統</p>
<h3>架構CMSimfly</h3>
<p>CMSimfly 以 Python 3 編寫, 利用 Flask 網路框架可以在伺服器運行, 讓使用者利用瀏覽器擷取動態 WWW 伺服器所送至近端的 html 加上 Javascript 程式碼, 然後在瀏覽器中顯示網際內容編輯器 (採用 tinymce4).</p>
<p>在使用者能夠透過 tinymce4 編輯各 CMSimfly 動態網際頁面之前, CMSimfly 利用 Beautiflysoup 4 對 config/content.htm 進行分頁, 然後將 H1 標註中的文字當作第一階的頁面, H2 與 H3 標註內容則當作第二階與第三階的頁面標題, 而標題與標題之間的 html 與 Javascript 則分別當作各階次頁面的內容.</p>
<p>因此 CMSimfly 可以在任何支援 Python 3 、Flask 與 Beautifulsoup 4 的環境中啟動 WWW 伺服器 (即在近端以 python wsgi.py 執行, 或在遠端以 uwsgi 與 nginx 執行 wsgi.py 中的 application), 接著使用者就可以根據伺服器啟動時所使用電腦的 IP 與埠號進行連線.</p>
<p>使用者連線後, Beautifulsoup 即對 config/content.htm 分頁, 然後根據頁面配置讓使用者在瀏覽器中使用 login 登入, 或者以動態的方式檢視各階次的分頁.</p>
<p>當使用者透過 login 登入 CMSimfly 成功後, 便可以指定頁面進行編輯, 修改後內容將存入 config/content.htm, 而尚未改版前的 content.htm 則改名為 content_backup.htm, 此一功能是防止 CMSimfly 因頁面解讀錯誤時, 誤刪資料時, 使用者可以從 content_backup.htm 取回上一版的資料內容.</p>
<h4>動態轉靜態內容</h4>
<p>由於動態 CMSimfly 只能在 Python3 環境中運行, 而某些免費的雲端服務所提供的 WWW 伺服器僅提供 html 加上 Javascript 伺服, 因此為了讓 CMSimfly 動態系統的內容, 能夠將內容送到這些只提供 WWW 伺服器的系統中執行, CMSimfly 加入 generate_pages 的功能, 也就是根據 config/content.htm 中各頁面的標題與資料, 以 Beautifulsoup4 再結合 lxml 模組, 將 content.htm 疊上各頁面所選定的 css 與其他配置頁面格式的 Javascript, 轉成位於 content 目錄中的靜態網站內容, 此一包含 index.html 的各頁面 html 檔案, 可以在任何只支援 html 伺服器的環境中運行, 例如: Github Pages 或 Fossil SCM 中的 doc 伺服頁面功能.</p>
<p>截至目前的說明, 希望啟動 CMSimfly 動態運行, 需要<span> </span><span>Python 3 、Flask 與 Beautifulsoup 4 , 若要將動態內容轉為靜態內容, 則額外需要 lxml 模組.</span></p>
<p><span>Python 3 在隨身系統的模組安裝指令為:</span></p>
<p><span>pip install flask bs4 lxml</span></p>
<p><span>表示要利用 pip 安裝 flask, bs4 與 lxml 模組.</span></p>
<p></p>
<h1>Game</h1>
<p>課本章節: <a href="https://link.springer.com/chapter/10.1007/978-1-4842-4155-4_2">https://link.springer.com/chapter/10.1007/978-1-4842-4155-4_2</a> </p>
<p>The player throws a pair of dice. The sum of the two top faces is what matters so a 1<br/>and a 3 is the same as 2 and 2. The sum of two 6-sided dice can be any number from 2 to<br/>12. If the player throws a 7 or 11 on the first throw, the player wins. If the player throws a 2, 3, or 12, the player loses. For any other result (4, 5, 6, 8, 9, 10), this result is recorded as what is called the player’s point and a follow-up throw is required. On follow-up throws, a throw of 7 loses and a throw of the player’s point wins. For anything else, the game continues with the follow-up throw rules.</p>
<h2>Game1</h2>
<p></p>
<p><button onclick="myFunction()">Try it</button></p>
<p id="demo"></p>
<pre class="brush:html;auto-links:false;toolbar:false" contenteditable="false">&lt;p&gt;&lt;button onclick="myFunction()"&gt;Try it&lt;/button&gt;&lt;/p&gt;
&lt;p id="demo"&gt;&lt;/p&gt;
&lt;script&gt;// &lt;![CDATA[
function myFunction() {
  document.getElementById("demo").innerHTML = Math.floor(Math.random()*10);
}
// ]]&gt;&lt;/script&gt;</pre>
<p><br/><br/></p>
<script>// <![CDATA[
function myFunction() {
  document.getElementById("demo").innerHTML = Math.floor(Math.random()*10);
}
// ]]></script>
<h2>Game2</h2>
<script>// <![CDATA[
function myFunction() {
  document.getElementById("demo").innerHTML = Math.floor(Math.random()*50+1);
}
// ]]></script>
<script type="text/javascript">// <![CDATA[
var cwidth = 400;
    var cheight = 300;
    var dicex = 50;
    var dicey = 50;
    var dicewidth = 100;
    var diceheight = 100;
    var dotrad = 6;
    var ctx;
    var dx;
    var dy;
    var firstturn = true;
    var point;
function throwdice() {
    var sum;
    var ch = 1+Math.floor(Math.random()*6);
    sum = ch;
    dx = dicex;
    dy = dicey;
    drawface(ch);
    dx = dicex + 150;
    ch=1 + Math.floor(Math.random()*6);
    sum += ch;
    drawface(ch);
    if (firstturn) {
        switch(sum) {
            case 7:
            case 11:
              document.f.outcome.value="You win!";
              break;
            case 2:
            case 3:
            case 12:
              document.f.outcome.value="You lose!";
              break;
            default:
              point = sum;
              document.f.pv.value=point;
              firstturn = false;
              document.f.stage.value="Need follow-up throw.";
              document.f.outcome.value="   ";
        }
    }
    else {
        switch(sum) {
        case point:
           document.f.outcome.value="You win!";
           document.f.stage.value="Back to first throw.";
           document.f.pv.value=" ";
           firstturn = true;
           break;
        case 7:
           document.f.outcome.value="You lose!";
           document.f.stage.value="Back to first throw.";
           document.f.pv.value=" ";
           firstturn = true;
        }
            }
}
function drawface(n) {
  ctx = document.getElementById('canvas').getContext('2d');  
  ctx.lineWidth = 5;
  ctx.clearRect(dx,dy,dicewidth,diceheight);
  ctx.strokeRect(dx,dy,dicewidth,diceheight)
  var dotx;
  var doty;
  ctx.fillStyle = "#009966";
    switch(n) {
        case 1:
         draw1();
         break;
        case 2:
         draw2();
         break;
        case 3:
         draw2();
         draw1();
         break;
        case 4:
         draw4();
         break;
        case 5:
         draw4();
         draw1();
         break;
        case 6:
         draw4();
         draw2mid();
         break;
         
    }
}
function draw1() {
    var dotx;
    var doty;
    ctx.beginPath();
    dotx = dx + .5*dicewidth;
    doty = dy + .5*diceheight;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    ctx.closePath();
    ctx.fill();
}
function draw2() {
    var dotx;
    var doty;
    ctx.beginPath();
    dotx = dx + 3*dotrad;
    doty = dy + 3*dotrad;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    dotx = dx+dicewidth-3*dotrad;
    doty = dy+diceheight-3*dotrad;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    ctx.closePath();
    ctx.fill();
}
function draw4() {
    var dotx;
    var doty;
    ctx.beginPath();
    dotx = dx + 3*dotrad;
    doty = dy + 3*dotrad;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    dotx = dx+dicewidth-3*dotrad;
    doty = dy+diceheight-3*dotrad;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    ctx.closePath();
    ctx.fill();
    ctx.beginPath();
    dotx = dx + 3*dotrad;
    doty = dy + diceheight-3*dotrad;  //no change
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    dotx = dx+dicewidth-3*dotrad;
    doty = dy+ 3*dotrad;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    ctx.closePath();
    ctx.fill(); 
}
function draw2mid() {
    var dotx;
    var doty;
    ctx.beginPath();
    dotx = dx + 3*dotrad;
    doty = dy + .5*diceheight;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    dotx = dx+dicewidth-3*dotrad;
    doty = dy + .5*diceheight; //no change
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    ctx.closePath();
    ctx.fill();
}
// ]]></script>
<p><canvas height="300" id="canvas" width="400"> Your browser doesn't support the HTML5 element canvas. </canvas> <br/> <button onclick="throwdice();">Throw dice </button></p>
<form id="f" name="f">Stage: <input name="stage" type="text" value="First Throw"/> Point: <input name="pv" type="text" value="   "/> Outcome: <input name="outcome" type="text" value="     "/></form>
<pre class="brush:html;auto-links:false;toolbar:false" contenteditable="false">&lt;script type="text/javascript"&gt;// &lt;![CDATA[
var cwidth = 400;
    var cheight = 300;
    var dicex = 50;
    var dicey = 50;
    var dicewidth = 100;
    var diceheight = 100;
    var dotrad = 6;
    var ctx;
    var dx;
    var dy;
    var firstturn = true;
    var point;
function throwdice() {
    var sum;
    var ch = 1+Math.floor(Math.random()*6);
    sum = ch;
    dx = dicex;
    dy = dicey;
    drawface(ch);
    dx = dicex + 150;
    ch=1 + Math.floor(Math.random()*6);
    sum += ch;
    drawface(ch);
    if (firstturn) {
        switch(sum) {
            case 7:
            case 11:
              document.f.outcome.value="You win!";
              break;
            case 2:
            case 3:
            case 12:
              document.f.outcome.value="You lose!";
              break;
            default:
              point = sum;
              document.f.pv.value=point;
              firstturn = false;
              document.f.stage.value="Need follow-up throw.";
              document.f.outcome.value="   ";
        }
    }
    else {
        switch(sum) {
        case point:
           document.f.outcome.value="You win!";
           document.f.stage.value="Back to first throw.";
           document.f.pv.value=" ";
           firstturn = true;
           break;
        case 7:
           document.f.outcome.value="You lose!";
           document.f.stage.value="Back to first throw.";
           document.f.pv.value=" ";
           firstturn = true;
        }
            }
}
function drawface(n) {
  ctx = document.getElementById('canvas').getContext('2d');  
  ctx.lineWidth = 5;
  ctx.clearRect(dx,dy,dicewidth,diceheight);
  ctx.strokeRect(dx,dy,dicewidth,diceheight)
  var dotx;
  var doty;
  ctx.fillStyle = "#009966";
    switch(n) {
        case 1:
         draw1();
         break;
        case 2:
         draw2();
         break;
        case 3:
         draw2();
         draw1();
         break;
        case 4:
         draw4();
         break;
        case 5:
         draw4();
         draw1();
         break;
        case 6:
         draw4();
         draw2mid();
         break;
         
    }
}
function draw1() {
    var dotx;
    var doty;
    ctx.beginPath();
    dotx = dx + .5*dicewidth;
    doty = dy + .5*diceheight;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    ctx.closePath();
    ctx.fill();
}
function draw2() {
    var dotx;
    var doty;
    ctx.beginPath();
    dotx = dx + 3*dotrad;
    doty = dy + 3*dotrad;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    dotx = dx+dicewidth-3*dotrad;
    doty = dy+diceheight-3*dotrad;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    ctx.closePath();
    ctx.fill();
}
function draw4() {
    var dotx;
    var doty;
    ctx.beginPath();
    dotx = dx + 3*dotrad;
    doty = dy + 3*dotrad;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    dotx = dx+dicewidth-3*dotrad;
    doty = dy+diceheight-3*dotrad;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    ctx.closePath();
    ctx.fill();
    ctx.beginPath();
    dotx = dx + 3*dotrad;
    doty = dy + diceheight-3*dotrad;  //no change
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    dotx = dx+dicewidth-3*dotrad;
    doty = dy+ 3*dotrad;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    ctx.closePath();
    ctx.fill(); 
}
function draw2mid() {
    var dotx;
    var doty;
    ctx.beginPath();
    dotx = dx + 3*dotrad;
    doty = dy + .5*diceheight;
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    dotx = dx+dicewidth-3*dotrad;
    doty = dy + .5*diceheight; //no change
    ctx.arc(dotx,doty,dotrad,0,Math.PI*2,true);
    ctx.closePath();
    ctx.fill();
}
// ]]&gt;&lt;/script&gt;
&lt;p&gt;&lt;canvas height="300" id="canvas" width="400"&gt; Your browser doesn't support the HTML5 element canvas. &lt;/canvas&gt; &lt;br&gt; &lt;button onclick="throwdice();"&gt;Throw dice &lt;/button&gt;&lt;/p&gt;
&lt;form id="f" name="f"&gt;Stage: &lt;input name="stage" type="text" value="First Throw"&gt; Point: &lt;input name="pv" type="text" value="   "&gt; Outcome: &lt;input name="outcome" type="text" value="     "&gt;&lt;/form&gt;</pre>
<p><br/><br/></p>
<h1>期中影片</h1>
<p><br/><iframe allowfullscreen="allowfullscreen" height="314" src="//www.youtube.com/embed/MppeZhV2zKI" width="560"></iframe></p>
<h1>網路連線配置與設定</h1>
<p>第一步:到任意網站(範例:Google Chrome)選取右上角管理--&gt;設定</p>
<p><img alt="" height="161" src="data:image/png;base64,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" width="394"/></p>
<p><img alt="" height="486" src="/images/p2.png" width="397"/></p>
<p>第二步:進階--&gt;系統-開啟Proxy設定</p>
<p><img alt="" height="345" src="/images/p3.png" width="698"/></p>
<p><img alt="" height="220" src="/images/p4.png" width="720"/></p>
<p>第三步:連線--&gt;LAN設定</p>
<p><img alt="" height="610" src="/images/p5.png" width="477"/></p>
<p>第四步:把位址改學校IP:140.130.17.3</p>
<p>學校連接<span>埠:3128</span></p>
<p><img caption="false" height="386" src="/images/p6.png" width="443"/></p>
<p>設定完成即可</p>
<p></p><h1>W14</h1>
<p>注意事項:需更改自己倉儲內的flaskapp.py檔才能顯示國旗</p>
<p>以下是需更改的程式碼:</p>
<p><strong><span>def savePage() 的修改</span></strong></p>
<pre class="brush:html;auto-links:false;toolbar:false" contenteditable="false">def savePage():
    """save all pages function"""
    page_content = request.form['page_content']
    # when element_format : "html", need to remove the annoying comment to prevent brython exec
    page_content = [w.replace('// &lt;![CDATA[', '') for w in page_content]
    page_content = [w.replace('// ]]&gt;', '') for w in page_content]
    # check if administrator</pre>
<p><strong><span>def ssavePage() 的修改</span></strong></p>
<pre class="brush:html;auto-links:false;toolbar:false" contenteditable="false">def ssavePage():
    """seperate save page function"""
    page_content = request.form['page_content']
    # when element_format : "html", need to remove the annoying comment to prevent brython exec
    page_content = page_content.replace('// &lt;![CDATA[', '')
    page_content = page_content.replace('// ]]&gt;', '')
    page_order = request.form['page_order']
    if not isAdmin():</pre>
<p>最新版本flaskapp.py:</p>
<pre class="brush:html;auto-links:false;toolbar:false" contenteditable="false"># coding: utf-8
from flask import Flask, send_from_directory, request, redirect, \
    render_template, session, make_response, url_for, flash
import random
import math
import os
# init.py 為自行建立的起始物件
import init
# 利用 nocache.py 建立 @nocache decorator, 讓頁面不會留下 cache
from nocache import nocache
# the followings are for cmsimfly
import re
import os
import math
import hashlib
# use quote_plus() to generate URL
import urllib.parse
# use cgi.escape() to resemble php htmlspecialchars()
# use cgi.escape() or html.escape to generate data for textarea tag, otherwise Editor can not deal with some Javascript code.
import cgi
import sys
# for new parse_content function
#from bs4 import BeautifulSoup
# 為了使用 bs4.element, 改為 import bs4
import bs4
# for ssavePage and savePage
import shutil
 
# get the current directory of the file
_curdir = os.path.join(os.getcwd(), os.path.dirname(__file__))
sys.path.append(_curdir)
 
# 由 init.py 中的 uwsgi = False 或 True 決定在 uwsgi 模式或近端模式執行
 
#ends for cmsimfly
 
# 假如隨後要利用 blueprint 架構時, 可以將程式放在子目錄中
# 然後利用 register 方式導入
# 導入 g1 目錄下的 user1.py
#import users.g1.user1
 
# 確定程式檔案所在目錄, 在 Windows 有最後的反斜線
_curdir = os.path.join(os.getcwd(), os.path.dirname(__file__))
# 表示程式在近端執行, 最後必須決定是由 init.py 或此地決定目錄設定
config_dir = _curdir + "/config/"
static_dir = _curdir + "/static"
download_dir = _curdir + "/downloads/"
image_dir = _curdir + "/images/"
 
# 利用 init.py 啟動, 建立所需的相關檔案
initobj = init.Init()
# 取 init.py 中 Init 類別中的 class uwsgi 變數 (static variable) 設定
uwsgi = init.Init.uwsgi
 
# 必須先將 download_dir 設為 static_folder, 然後才可以用於 download 方法中的 app.static_folder 的呼叫
app = Flask(__name__)
 
# 設置隨後要在 blueprint 應用程式中引用的 global 變數
app.config['config_dir'] = config_dir
app.config['static_dir'] = static_dir
app.config['download_dir'] = download_dir
 
# 使用 session 必須要設定 secret_key
# In order to use sessions you have to set a secret key
# set the secret key.  keep this really secret:
app.secret_key = 'A0Zr9@8j/3yX R~XHH!jmN]LWX/,?R@T'
 
# 子目錄中註冊藍圖位置
#app.register_blueprint(users.g1.user1.g1app)
 
 
@app.route('/checkLogin', methods=['POST'])
def checkLogin():
    """Check user login process."""
    password = request.form["password"]
    site_title, saved_password = parse_config()
    hashed_password = hashlib.sha512(password.encode('utf-8')).hexdigest()
    if hashed_password == saved_password:
        session['admin'] = 1
        return redirect('/edit_page')
    return redirect('/')
 
  
@app.route('/delete_file', methods=['POST'])
def delete_file():
    """Delete user uploaded files."""
    if not isAdmin():
        return redirect("/login")
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
    filename = request.form['filename']
    if filename is None:
        outstring = "no file selected!"
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                   directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Delete Error&lt;/h1&gt;" + \
                   outstring + "&lt;br/&gt;&lt;br /&gt;&lt;/body&gt;&lt;/html&gt;"
    outstring = "delete all these files?&lt;br /&gt;&lt;br /&gt;"
    outstring += "&lt;form method='post' action='doDelete'&gt;"
    # only one file is selected
    if isinstance(filename, str):
        outstring += filename + "&lt;input type='hidden' name='filename' value='" + \
                            filename + "'&gt;&lt;br /&gt;"
    else:
        # multiple files selected
        for index in range(len(filename)):
            outstring += filename[index] + "&lt;input type='hidden' name='filename' value='" + \
                                filename[index]+"'&gt;&lt;br /&gt;"
    outstring += "&lt;br /&gt;&lt;input type='submit' value='delete'&gt;&lt;/form&gt;"
 
    return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
               directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Download List&lt;/h1&gt;" + \
               outstring + "&lt;br/&gt;&lt;br /&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
@app.route('/doDelete', methods=['POST'])
def doDelete():
    """Action to delete user uploaded files."""
    if not isAdmin():
        return redirect("/login")
    # delete files
    filename = request.form['filename']
    outstring = "all these files will be deleted:&lt;br /&gt;&lt;br /&gt;"
    # only select one file
    if isinstance(filename, str):
        try:
            os.remove(download_dir + "/" + filename)
            outstring += filename + " deleted!"
        except:
            outstring += filename + "Error, can not delete files!&lt;br /&gt;"
    else:
        # multiple files selected
        for index in range(len(filename)):
            try:
                os.remove(download_dir + "/" + filename[index])
                outstring += filename[index] + " deleted!&lt;br /&gt;"
            except:
                outstring += filename[index] + "Error, can not delete files!&lt;br /&gt;"
 
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
 
    return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
               directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Download List&lt;/h1&gt;" + \
               outstring + "&lt;br/&gt;&lt;br /&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
@app.route('/doSearch', methods=['POST'])
def doSearch():
    """Action to search content.htm using keyword"""
    if not isAdmin():
        return redirect("/login")
    else:
        keyword = request.form['keyword']
        head, level, page = parse_content()
        directory = render_menu(head, level, page)
        match = ""
        for index in range(len(head)):
            if (keyword != "" or None) and (keyword.lower() in page[index].lower() or \
            keyword.lower() in head[index].lower()): \
                match += "&lt;a href='/get_page/" + head[index] + "'&gt;" + \
                                head[index] + "&lt;/a&gt;&lt;br /&gt;"
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;"+ \
                   directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Search Result&lt;/h1&gt;keyword: " + \
                   keyword.lower() + "&lt;br /&gt;&lt;br /&gt;in the following pages:&lt;br /&gt;&lt;br /&gt;" + \
                   match + "&lt;/section&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
@app.route('/download/', methods=['GET'])
def download():
    """Download file using URL."""
    filename = request.args.get('filename')
    type = request.args.get('type')
    if type == "files":
        return send_from_directory(download_dir, filename=filename)
    else:
    # for image files
        return send_from_directory(image_dir, filename=filename)
     
 
@app.route('/download_list', methods=['GET'])
def download_list():
    """List files in downloads directory."""
    if not isAdmin():
        return redirect("/login")
    else:
        if not request.args.get('edit'):
            edit= 1
        else:
            edit = request.args.get('edit')
        if not request.args.get('page'):
            page = 1
        else:
            page = request.args.get('page')
        if not request.args.get('item_per_page'):
            item_per_page = 10
        else:
            item_per_page = request.args.get('item_per_page')
        if not request.args.get('keyword'):
            keyword = ""
        else:
            keyword = request.args.get('keyword')
            session['download_keyword'] = keyword
    files = os.listdir(download_dir)
    if keyword is not "":
        files = [elem for elem in files if str(keyword) in elem]
    files.sort()
    total_rows = len(files)
    totalpage = math.ceil(total_rows/int(item_per_page))
    starti = int(item_per_page) * (int(page) - 1) + 1
    endi = starti + int(item_per_page) - 1
    outstring = "&lt;form method='post' action='delete_file'&gt;"
    notlast = False
    if total_rows &gt; 0:
        outstring += "&lt;br /&gt;"
        if (int(page) * int(item_per_page)) &lt; total_rows:
            notlast = True
        if int(page) &gt; 1:
            outstring += "&lt;a href='"
            outstring += "download_list?&amp;page=1&amp;item_per_page=" + str(item_per_page) + \
                                "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;&lt;&lt;&lt;/a&gt; "
            page_num = int(page) - 1
            outstring += "&lt;a href='"
            outstring += "download_list?&amp;page=" + str(page_num) + "&amp;item_per_page=" + \
                                str(item_per_page) + "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;Previous&lt;/a&gt; "
 
        span = 10
 
        for index in range(int(page)-span, int(page)+span):
            if index&gt;= 0 and index&lt; totalpage:
                page_now = index + 1
                if page_now == int(page):
                    outstring += "&lt;font size='+1' color='red'&gt;" + str(page) + " &lt;/font&gt;"
                else:
                    outstring += "&lt;a href='"
                    outstring += "download_list?&amp;page=" + str(page_now) + "&amp;item_per_page=" + \
                                        str(item_per_page) + "&amp;keyword=" + str(session.get('download_keyword'))
                    outstring += "'&gt;"+str(page_now) + "&lt;/a&gt; "
 
        if notlast == True:
            nextpage = int(page) + 1
            outstring += " &lt;a href='"
            outstring += "download_list?&amp;page=" + str(nextpage) + "&amp;item_per_page=" + \
                                str(item_per_page) + "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;Next&lt;/a&gt;"
            outstring += " &lt;a href='"
            outstring += "download_list?&amp;page=" + str(totalpage) + "&amp;item_per_page=" + \
                                str(item_per_page) + "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;&gt;&gt;&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;"
 
        if (int(page) * int(item_per_page)) &lt; total_rows:
            notlast = True
            outstring += downloadlist_access_list(files, starti, endi) + "&lt;br /&gt;"
        else:
            outstring += "&lt;br /&gt;&lt;br /&gt;"
            outstring += downloadlist_access_list(files, starti, total_rows) + "&lt;br /&gt;"
 
        if int(page) &gt; 1:
            outstring += "&lt;a href='"
            outstring += "download_list?&amp;page=1&amp;item_per_page=" + str(item_per_page) + \
                                "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;&lt;&lt;&lt;/a&gt; "
            page_num = int(page) - 1
            outstring += "&lt;a href='"
            outstring += "download_list?&amp;page=" + str(page_num) + "&amp;item_per_page=" + \
                                str(item_per_page) + "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;Previous&lt;/a&gt; "
 
        span = 10
 
        for index in range(int(page)-span, int(page)+span):
        #for ($j=$page-$range;$j&lt;$page+$range;$j++)
            if index &gt;=0 and index &lt; totalpage:
                page_now = index + 1
                if page_now == int(page):
                    outstring += "&lt;font size='+1' color='red'&gt;" + str(page)+" &lt;/font&gt;"
                else:
                    outstring += "&lt;a href='"
                    outstring += "download_list?&amp;page=" + str(page_now) + \
                                        "&amp;item_per_page=" + str(item_per_page) + \
                                        "&amp;keyword=" + str(session.get('download_keyword'))
                    outstring += "'&gt;" + str(page_now)+"&lt;/a&gt; "
 
        if notlast == True:
            nextpage = int(page) + 1
            outstring += " &lt;a href='"
            outstring += "download_list?&amp;page=" + str(nextpage) + "&amp;item_per_page=" + \
                                str(item_per_page) + "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;Next&lt;/a&gt;"
            outstring += " &lt;a href='"
            outstring += "download_list?&amp;page=" + str(totalpage) + "&amp;item_per_page=" + \
                                str(item_per_page) + "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;&gt;&gt;&lt;/a&gt;"
    else:
        outstring += "no data!"
    outstring += "&lt;br /&gt;&lt;br /&gt;&lt;input type='submit' value='delete'&gt;&lt;input type='reset' value='reset'&gt;&lt;/form&gt;"
 
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
 
    return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
               directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Download List&lt;/h1&gt;" + outstring + "&lt;br/&gt;&lt;br /&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
def downloadlist_access_list(files, starti, endi):
    """List files function for download_list."""
    # different extension files, associated links were provided
    # popup window to view images, video or STL files, other files can be downloaded directly
    # files are all the data to list, from starti to endi
    # add file size
    outstring = ""
    for index in range(int(starti)-1, int(endi)):
        fileName, fileExtension = os.path.splitext(files[index])
        fileExtension = fileExtension.lower()
        fileSize = sizeof_fmt(os.path.getsize(download_dir+"/"+files[index]))
        # images files
        if fileExtension == ".png" or fileExtension == ".jpg" or fileExtension == ".gif":
            outstring += '&lt;input type="checkbox" name="filename" value="' + \
                              files[index] + '"&gt;&lt;a href="javascript:;" onClick="window.open(\'/images/'+ \
                              files[index] + '\',\'images\', \'catalogmode\',\'scrollbars\')"&gt;' + \
                              files[index] + '&lt;/a&gt; (' + str(fileSize) + ')&lt;br /&gt;'
        # stl files
        elif fileExtension == ".stl":
            outstring += '&lt;input type="checkbox" name="filename" value="' + \
                              files[index] + '"&gt;&lt;a href="javascript:;" onClick="window.open(\'/static/viewstl.html?src=/downloads/' + \
                              files[index] + '\',\'images\', \'catalogmode\',\'scrollbars\')"&gt;' + \
                              files[index] + '&lt;/a&gt; (' + str(fileSize) + ')&lt;br /&gt;'
        # flv files
        elif fileExtension == ".flv":
            outstring += '&lt;input type="checkbox" name="filename" value="' + \
                              files[index] + '"&gt;&lt;a href="javascript:;" onClick="window.open(\'/flvplayer?filepath=/downloads/' + \
            files[index] + '\',\'images\', \'catalogmode\',\'scrollbars\')"&gt;' + files[index] + '&lt;/a&gt; (' + str(fileSize) + ')&lt;br /&gt;'
        # direct download files
        else:
            outstring += "&lt;input type='checkbox' name='filename' value='" + files[index] + \
                              "'&gt;&lt;a href='/downloads/" + files[index] + "'&gt;" + files[index] + \
                              "&lt;/a&gt; (" + str(fileSize) + ")&lt;br /&gt;"
    return outstring
 
 
# downloads 方法主要將位於 downloads 目錄下的檔案送回瀏覽器
@app.route('/downloads/&lt;path:path&gt;')
def downloads(path):
    """Send files in downloads directory."""
    return send_from_directory(_curdir+"/downloads/", path)
 
 
# 與 file_selector 搭配的取檔程式
def downloadselect_access_list(files, starti, endi):
    """Accompanied with file_selector."""
    outstring = ""
    for index in range(int(starti)-1, int(endi)):
        fileName, fileExtension = os.path.splitext(files[index])
        fileSize = os.path.getsize(download_dir + "/" + files[index])
        outstring += '''&lt;input type="checkbox" name="filename" value="''' + \
                          files[index] + '''"&gt;&lt;a href="#" onclick='window.setLink("/downloads/''' + \
                          files[index] + '''",0); return false;'&gt;''' + files[index] + \
                          '''&lt;/a&gt; (''' + str(sizeof_fmt(fileSize)) + ''')&lt;br /&gt;'''
    return outstring
 
 
@app.route('/edit_config', defaults={'edit': 1})
@app.route('/edit_config/&lt;path:edit&gt;')
def edit_config(edit):
    """Config edit html form."""
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
    if not isAdmin():
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                 directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Login&lt;/h1&gt;&lt;form method='post' action='checkLogin'&gt; \
                 Password:&lt;input type='password' name='password'&gt; \
                 &lt;input type='submit' value='login'&gt;&lt;/form&gt; \
                 &lt;/section&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"
    else:
        site_title, password = parse_config()
        # edit config file
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                 directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Edit Config&lt;/h1&gt;&lt;form method='post' action='saveConfig'&gt; \
                 Site Title:&lt;input type='text' name='site_title' value='"+site_title+"' size='50'&gt;&lt;br /&gt; \
                 Password:&lt;input type='text' name='password' value='"+password+"' size='50'&gt;&lt;br /&gt; \
                 &lt;input type='hidden' name='password2' value='"+password+"'&gt; \
                 &lt;input type='submit' value='send'&gt;&lt;/form&gt; \
                 &lt;/section&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
# edit all page content
@app.route('/edit_page', defaults={'edit': 1})
@app.route('/edit_page/&lt;path:edit&gt;')
def edit_page(edit):
    """Page edit html form."""
    # check if administrator
    if not isAdmin():
        return redirect('/login')
    else:
        head, level, page = parse_content()
        directory = render_menu(head, level, page)
        pagedata =file_get_contents(config_dir + "content.htm")
        outstring = tinymce_editor(directory, cgi.escape(pagedata))
        return outstring
 
 
def editorfoot():
    return '''&lt;body&gt;'''
 
 
def editorhead():
    return '''
    &lt;br /&gt;
&lt;!--&lt;script src="//cdn.tinymce.com/4/tinymce.min.js"&gt;&lt;/script&gt;--&gt;
&lt;script src="./../static/tinymce4/tinymce/tinymce.min.js"&gt;&lt;/script&gt;
&lt;script src="./../static/tinymce4/tinymce/plugins/sh4tinymce/plugin.min.js"&gt;&lt;/script&gt;
&lt;link rel = "stylesheet" href = "/static/tinymce4/tinymce/plugins/sh4tinymce/style/style.css"&gt;
&lt;script&gt;
tinymce.init({
  selector: "textarea",
  height: 500,
  element_format : "html",
  language : "en",
  valid_elements : '*[*]',
  extended_valid_elements: "script[language|type|src]",
  plugins: [
    'advlist autolink lists link image charmap print preview hr anchor pagebreak',
    'searchreplace wordcount visualblocks visualchars code fullscreen',
    'insertdatetime media nonbreaking save table contextmenu directionality',
    'emoticons template paste textcolor colorpicker textpattern imagetools sh4tinymce'
  ],
  toolbar1: 'insertfile save undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent',
  toolbar2: 'link image | print preview media | forecolor backcolor emoticons | code sh4tinymce',
  relative_urls: false,
  toolbar_items_size: 'small',
  file_picker_callback: function(callback, value, meta) {
        cmsFilePicker(callback, value, meta);
    },
  templates: [
    { title: 'Test template 1', content: 'Test 1' },
    { title: 'Test template 2', content: 'Test 2' }
  ],
  content_css: [
    '//fonts.googleapis.com/css?family=Lato:300,300i,400,400i',
    '//www.tinymce.com/css/codepen.min.css'
  ]
});
 
function cmsFilePicker(callback, value, meta) {
    tinymce.activeEditor.windowManager.open({
        title: 'Uploaded File Browser',
        url: '/file_selector?type=' + meta.filetype,
        width: 800,
        height: 550,
    }, {
        oninsert: function (url, objVals) {
            callback(url, objVals);
        }
    });
};
&lt;/script&gt;
'''
 
 
@app.route('/error_log')
def error_log(self, info="Error"):
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
    return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
             directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;ERROR&lt;/h1&gt;" + info + "&lt;/section&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
def file_get_contents(filename):
    # open file in utf-8 and return file content
    with open(filename, encoding="utf-8") as file:
        return file.read()
 
 
# 與 file_selector 配合, 用於 Tinymce4 編輯器的檔案選擇
def file_lister(directory, type=None, page=1, item_per_page=10):
    files = os.listdir(directory)
    total_rows = len(files)
    totalpage = math.ceil(total_rows/int(item_per_page))
    starti = int(item_per_page) * (int(page) - 1) + 1
    endi = starti + int(item_per_page) - 1
    outstring = file_selector_script()
    notlast = False
    if total_rows &gt; 0:
        outstring += "&lt;br /&gt;"
        if (int(page) * int(item_per_page)) &lt; total_rows:
            notlast = True
        if int(page) &gt; 1:
            outstring += "&lt;a href='"
            outstring += "file_selector?type=" + type + \
                              "&amp;page=1&amp;item_per_page=" + \
                              str(item_per_page) + "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;&lt;&lt;&lt;/a&gt; "
            page_num = int(page) - 1
            outstring += "&lt;a href='"
            outstring += "file_selector?type=" + type + \
                              "&amp;page=" + str(page_num) + \
                              "&amp;item_per_page=" +str(item_per_page) + \
                              "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;Previous&lt;/a&gt; "
        span = 10
        for index in range(int(page)-span, int(page)+span):
            if index&gt;= 0 and index&lt; totalpage:
                page_now = index + 1
                if page_now == int(page):
                    outstring += "&lt;font size='+1' color='red'&gt;" + str(page) + " &lt;/font&gt;"
                else:
                    outstring += "&lt;a href='"
                    outstring += "file_selector?type=" + type + "&amp;page=" + \
                                      str(page_now) + "&amp;item_per_page=" + \
                                      str(item_per_page) + "&amp;keyword=" + \
                                      str(session.get('download_keyword'))
                    outstring += "'&gt;" + str(page_now)+"&lt;/a&gt; "
 
        if notlast == True:
            nextpage = int(page) + 1
            outstring += " &lt;a href='"
            outstring += "file_selector?type=" + type + "&amp;page=" + \
                               str(nextpage) + "&amp;item_per_page=" + \
                               str(item_per_page) + "&amp;keyword=" + \
                               str(session.get('download_keyword'))
            outstring += "'&gt;Next&lt;/a&gt;"
            outstring += " &lt;a href='"
            outstring += "file_selector?type=" + type + "&amp;page=" + \
                               str(totalpage) + "&amp;item_per_page=" + \
                               str(item_per_page) + "&amp;keyword=" + \
                               str(session.get('download_keyword'))
            outstring += "'&gt;&gt;&gt;&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;"
        if (int(page) * int(item_per_page)) &lt; total_rows:
            notlast = True
            if type == "file":
                outstring += downloadselect_access_list(files, starti, endi) + "&lt;br /&gt;"
            else:
                outstring += imageselect_access_list(files, starti, endi) + "&lt;br /&gt;"
        else:
            outstring += "&lt;br /&gt;&lt;br /&gt;"
            if type == "file":
                outstring += downloadselect_access_list(files, starti, total_rows) + "&lt;br /&gt;"
            else:
                outstring += imageselect_access_list(files, starti, total_rows) + "&lt;br /&gt;"
        if int(page) &gt; 1:
            outstring += "&lt;a href='"
            outstring += "file_selector?type=" + type + \
                              "&amp;page=1&amp;item_per_page=" + str(item_per_page) + \
                              "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;&lt;&lt;&lt;/a&gt; "
            page_num = int(page) - 1
            outstring += "&lt;a href='"
            outstring += "file_selector?type=" + type + "&amp;page=" + \
                               str(page_num) + "&amp;item_per_page=" + \
                               str(item_per_page) + "&amp;keyword=" + \
                               str(session.get('download_keyword'))
            outstring += "'&gt;Previous&lt;/a&gt;"
        span = 10
        for index in range(int(page)-span, int(page)+span):
            if index &gt;=0 and index &lt; totalpage:
                page_now = index + 1
                if page_now == int(page):
                    outstring += "&lt;font size='+1' color='red'&gt;"+str(page)+" &lt;/font&gt;"
                else:
                    outstring += "&lt;a href='"
                    outstring += "file_selector?type=" + type + "&amp;page=" + \
                                       str(page_now) + "&amp;item_per_page=" + \
                                       str(item_per_page) + "&amp;keyword=" + \
                                       str(session.get('download_keyword'))
                    outstring += "'&gt;" + str(page_now) + "&lt;/a&gt; "
        if notlast == True:
            nextpage = int(page) + 1
            outstring += " &lt;a href='"
            outstring += "file_selector?type=" + type + "&amp;page=" + \
                               str(nextpage) + "&amp;item_per_page=" + \
                               str(item_per_page) + "&amp;keyword=" + \
                               str(session.get('download_keyword'))
            outstring += "'&gt;Next&lt;/a&gt;"
            outstring += " &lt;a href='"
            outstring += "file_selector?type=" + type + "&amp;page=" + \
                               str(totalpage) + "&amp;item_per_page=" + \
                               str(item_per_page) + "&amp;keyword=" + str(session.get('download_keyword'))
            outstring += "'&gt;&gt;&gt;&lt;/a&gt;"
    else:
        outstring += "no data!"
 
    if type == "file":
        return outstring+"&lt;br /&gt;&lt;br /&gt;&lt;a href='fileuploadform'&gt;file upload&lt;/a&gt;"
    else:
        return outstring+"&lt;br /&gt;&lt;br /&gt;&lt;a href='imageuploadform'&gt;image upload&lt;/a&gt;"
 
 
# 配合 Tinymce4 讓使用者透過 html editor 引用所上傳的 files 與 images
@app.route('/file_selector', methods=['GET'])
def file_selector():
    if not isAdmin():
        return redirect("/login")
    else:
        if not request.args.get('type'):
            type= "file"
        else:
            type = request.args.get('type')
        if not request.args.get('page'):
            page = 1
        else:
            page = request.args.get('page')
        if not request.args.get('item_per_page'):
            item_per_page = 10
        else:
            item_per_page = request.args.get('item_per_page')
        if not request.args.get('keyword'):
            keyword = None
        else:
            keyword = request.args.get('keyword')
 
        if type == "file":
 
            return file_lister(download_dir, type, page, item_per_page)
        elif type == "image":
            return file_lister(image_dir, type, page, item_per_page)
 
 
def file_selector_script():
    return '''
&lt;script language="javascript" type="text/javascript"&gt;
$(function(){
    $('.a').on('click', function(event){
        setLink();
    });
});
 
function setLink (url, objVals) {
    top.tinymce.activeEditor.windowManager.getParams().oninsert(url, objVals);
    top.tinymce.activeEditor.windowManager.close();
    return false;
}
&lt;/script&gt;
'''
 
 
@app.route('/fileaxupload', methods=['POST'])
# ajax jquery chunked file upload for flask
def fileaxupload():
    if isAdmin():
        # need to consider if the uploaded filename already existed.
        # right now all existed files will be replaced with the new files
        filename = request.args.get("ax-file-name")
        flag = request.args.get("start")
        if flag == "0":
            file = open(_curdir + "/downloads/" + filename, "wb")
        else:
            file = open(_curdir + "/downloads/" + filename, "ab")
        file.write(request.stream.read())
        file.close()
        return "files uploaded!"
    else:
        return redirect("/login")
 
 
@app.route('/fileuploadform', defaults={'edit':1})
@app.route('/fileuploadform/&lt;path:edit&gt;')
def fileuploadform(edit):
    if isAdmin():
        head, level, page = parse_content()
        directory = render_menu(head, level, page)
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;"+ \
                 directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;file upload&lt;/h1&gt;" + \
                 '''&lt;script src="./../static/jquery.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script src="./../static/axuploader.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script&gt;
$(document).ready(function(){
$('.prova').axuploader({url:'fileaxupload', allowExt:['jpg','png','gif','7z','pdf','zip','flv','stl','swf'],
finish:function(x,files)
    {
        alert('All files have been uploaded: '+files);
    },
enable:true,
remotePath:function(){
return 'downloads/';
}
});
});
&lt;/script&gt;
&lt;div class="prova"&gt;&lt;/div&gt;
&lt;input type="button" onclick="$('.prova').axuploader('disable')" value="asd" /&gt;
&lt;input type="button" onclick="$('.prova').axuploader('enable')" value="ok" /&gt;
&lt;/section&gt;&lt;/body&gt;&lt;/html&gt;
'''
    else:
        return redirect("/login")
 
 
@app.route('/flvplayer')
# 需要檢視能否取得 filepath 變數
def flvplayer(filepath=None):
    outstring = '''
&lt;object type="application/x-shockwave-flash" data="/static/player_flv_multi.swf" width="320" height="240"&gt;
     &lt;param name="movie" value="player_flv_multi.swf" /&gt;
     &lt;param name="allowFullScreen" value="true" /&gt;
     &lt;param name="FlashVars" value="flv=''' + filepath + '''&amp;width=320&amp;height=240&amp;showstop=1&amp;showvolume=1&amp;showtime=1
     &amp;startimage=/static/startimage_en.jpg&amp;showfullscreen=1&amp;bgcolor1=189ca8&amp;bgcolor2=085c68
     &amp;playercolor=085c68" /&gt;
&lt;/object&gt;
'''
    return outstring
 
 
@app.route('/generate_pages')
def generate_pages():
    # 必須決定如何處理重複標題頁面的轉檔
    import os
    # 確定程式檔案所在目錄, 在 Windows 有最後的反斜線
    _curdir = os.path.join(os.getcwd(), os.path.dirname(__file__))
    # 根據 content.htm 內容, 逐一產生各頁面檔案
    # 在此也要同時配合 render_menu2, 產生對應的 anchor 連結
    head, level, page = parse_content()
    # 處理重複標題 head 數列， 再重複標題按照次序加上 1, 2, 3...
    newhead = []
    for i, v in enumerate(head):
        # 各重複標題總數
        totalcount = head.count(v)
        # 目前重複標題出現總數
        count = head[:i].count(v)
        # 針對重複標題者, 附加目前重複標題出現數 +1, 未重複採原標題
        newhead.append(v + "-" + str(count + 1) if totalcount &gt; 1 else v)
    # 刪除 content 目錄中所有 html 檔案
    filelist = [ f for f in os.listdir(_curdir + "\\content\\") if f.endswith(".html") ]
    for f in filelist:
        os.remove(os.path.join(_curdir + "\\content\\", f))
    # 這裡需要建立專門寫出 html 的 write_page
    # index.html
    with open(_curdir + "\\content\\index.html", "w", encoding="utf-8") as f:
        f.write(get_page2(None, newhead, 0))
    # sitemap
    with open(_curdir + "\\content\\sitemap.html", "w", encoding="utf-8") as f:
        # sitemap2 需要 newhead
        f.write(sitemap2(newhead))
    # 以下轉檔, 改用 newhead 數列
 
    def visible(element):
        if element.parent.name in ['style', 'script', '[document]', 'head', 'title']:
            return False
        elif re.match('&lt;!--.*--&gt;', str(element.encode('utf-8'))):
            return False
        return True
 
    search_content = []
    for i in range(len(newhead)):
        # 在此必須要將頁面中的 /images/ 字串換為 images/, /downloads/ 換為 downloads/
        # 因為 Flask 中靠 /images/ 取檔案, 但是一般 html 則採相對目錄取檔案
        # 此一字串置換在 get_page2 中進行
        # 加入 tipue search 模式
        get_page_content = []
        html_doc = get_page2(newhead[i], newhead, 0, get_page_content)
        soup = bs4.BeautifulSoup(" ".join(get_page_content), "lxml")
        search_content.append({"title": newhead[i], "text": " ".join(filter(visible, soup.findAll(text=True))), "tags": "", "url": newhead[i] + ".html"})
        with open(_curdir + "\\content\\" + newhead[i] + ".html", "w", encoding="utf-8") as f:
            # 增加以 newhead 作為輸入
            f.write(html_doc)
    # GENERATE js file
    with open(_curdir + "\\content\\tipuesearch_content.js", "w", encoding="utf-8") as f:
        f.write("var tipuesearch = {\"pages\": " + str(search_content) + "};")
    # generate each page html under content directory
    return "已經將網站轉為靜態網頁. &lt;a href='/'&gt;Home&lt;/a&gt;"
# seperate page need heading and edit variables, if edit=1, system will enter edit mode
# single page edit will use ssavePage to save content, it means seperate save page
@app.route('/get_page')
@app.route('/get_page/&lt;heading&gt;', defaults={'edit': 0})
@app.route('/get_page/&lt;heading&gt;/&lt;int:edit&gt;')
def get_page(heading, edit):
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
    if heading is None:
        heading = head[0]
    # 因為同一 heading 可能有多頁, 因此不可使用 head.index(heading) 搜尋 page_order
    page_order_list, page_content_list = search_content(head, page, heading)
    return_content = ""
    pagedata = ""
    outstring = ""
    outstring_duplicate = ""
    pagedata_duplicate = ""
    outstring_list = []
    for i in range(len(page_order_list)):
        #page_order = head.index(heading)
        page_order = page_order_list[i]
        if page_order == 0:
            last_page = ""
        else:
            last_page = head[page_order-1] + " &lt;&lt; &lt;a href='/get_page/" + \
                             head[page_order-1] + "'&gt;Previous&lt;/a&gt;"
        if page_order == len(head) - 1:
            # no next page
            next_page = ""
        else:
            next_page = "&lt;a href='/get_page/"+ head[page_order+1] + \
                              "'&gt;Next&lt;/a&gt; &gt;&gt; " + head[page_order+1]
        if len(page_order_list) &gt; 1:
            return_content += last_page + " " + next_page + \
                                      "&lt;br /&gt;&lt;h1&gt;" + heading + "&lt;/h1&gt;" + \
                                      page_content_list[i] + "&lt;br /&gt;"+ \
                                      last_page + " " + next_page + "&lt;br /&gt;&lt;hr&gt;"
            pagedata_duplicate = "&lt;h"+level[page_order] + "&gt;" + heading + \
                                          "&lt;/h"+level[page_order] + "&gt;" + page_content_list[i]
            outstring_list.append(last_page + " " + next_page + "&lt;br /&gt;" + tinymce_editor(directory, cgi.escape(pagedata_duplicate), page_order))
        else:
            return_content += last_page + " " + next_page + "&lt;br /&gt;&lt;h1&gt;" +\
                                      heading + "&lt;/h1&gt;" + page_content_list[i] + "&lt;br /&gt;" + last_page + " " + next_page
             
        pagedata += "&lt;h"+level[page_order] + "&gt;" + heading + "&lt;/h" + level[page_order] + "&gt;" + page_content_list[i]
        # 利用 cgi.escape() 將 specialchar 轉成只能顯示的格式
        outstring += last_page + " " + next_page + "&lt;br /&gt;" + tinymce_editor(directory, cgi.escape(pagedata), page_order)
     
    # edit=0 for viewpage
    if edit == 0:
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                 directory + "&lt;/nav&gt;&lt;section&gt;" + return_content + "&lt;/section&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"
    # enter edit mode
    else:
        # check if administrator
        if not isAdmin():
            redirect(url_for('login'))
        else:
            if len(page_order_list) &gt; 1:
                # 若碰到重複頁面頁印, 且要求編輯, 則導向 edit_page
                #return redirect("/edit_page")
                for i in range(len(page_order_list)):
                    outstring_duplicate += outstring_list[i] + "&lt;br /&gt;&lt;hr&gt;"
                return outstring_duplicate
            else:
            #pagedata = "&lt;h"+level[page_order]+"&gt;"+heading+"&lt;/h"+level[page_order]+"&gt;"+search_content(head, page, heading)
            #outstring = last_page+" "+next_page+"&lt;br /&gt;"+ tinymce_editor(directory, cgi.escape(pagedata), page_order)
                return outstring
 
 
# seperate page need heading and edit variables, if edit=1, system will enter edit mode
# single page edit will use ssavePage to save content, it means seperate save page
'''
@app.route('/get_page2')
@app.route('/get_page2/&lt;heading&gt;', defaults={'edit': 0})
@app.route('/get_page2/&lt;heading&gt;/&lt;int:edit&gt;')
'''
# before add tipue search function
#def get_page2(heading, head, edit):
def get_page2(heading, head, edit, get_page_content = None):
    not_used_head, level, page = parse_content()
    # 直接在此將 /images/ 換為 ./../images/, /downloads/ 換為 ./../downloads/, 以 content 為基準的相對目錄設定
    page = [w.replace('src="./../images/', 'src="./../images/') for w in page]
    page = [w.replace('href="./../downloads/', 'href="./../downloads/') for w in page]
    # 假如有 src="./../static/ace/則換為 src="./../static/ace/
    page = [w.replace('src="./../static/', 'src="./../static/') for w in page]
    directory = render_menu2(head, level, page)
    if heading is None:
        heading = head[0]
    # 因為同一 heading 可能有多頁, 因此不可使用 head.index(heading) 搜尋 page_order
    page_order_list, page_content_list = search_content(head, page, heading)
    if get_page_content is not None:
        get_page_content.extend(page_content_list)
    return_content = ""
    pagedata = ""
    outstring = ""
    outstring_duplicate = ""
    pagedata_duplicate = ""
    outstring_list = []
    for i in range(len(page_order_list)):
        #page_order = head.index(heading)
        page_order = page_order_list[i]
        if page_order == 0:
            last_page = ""
        else:
            #last_page = head[page_order-1]+ " &lt;&lt; &lt;a href='/get_page/" + head[page_order-1] + "'&gt;Previous&lt;/a&gt;"
            last_page = head[page_order-1] + " &lt;&lt; &lt;a href='"+head[page_order-1] + ".html'&gt;Previous&lt;/a&gt;"
        if page_order == len(head) - 1:
            # no next page
            next_page = ""
        else:
            #next_page = "&lt;a href='/get_page/"+head[page_order+1] + "'&gt;Next&lt;/a&gt; &gt;&gt; " + head[page_order+1]
            next_page = "&lt;a href='" + head[page_order+1] + ".html'&gt;Next&lt;/a&gt; &gt;&gt; " + head[page_order+1]
        if len(page_order_list) &gt; 1:
            return_content += last_page + " " + next_page + "&lt;br /&gt;&lt;h1&gt;" + \
                                      heading + "&lt;/h1&gt;" + page_content_list[i] + \
                                      "&lt;br /&gt;" + last_page + " "+ next_page + "&lt;br /&gt;&lt;hr&gt;"
            pagedata_duplicate = "&lt;h"+level[page_order] + "&gt;" + heading + "&lt;/h" + level[page_order]+"&gt;"+page_content_list[i]
            outstring_list.append(last_page + " " + next_page + "&lt;br /&gt;" + tinymce_editor(directory, cgi.escape(pagedata_duplicate), page_order))
        else:
            return_content += last_page + " " + next_page + "&lt;br /&gt;&lt;h1&gt;" + \
                                      heading + "&lt;/h1&gt;" + page_content_list[i] + \
                                      "&lt;br /&gt;" + last_page + " " + next_page
             
        pagedata += "&lt;h" + level[page_order] + "&gt;" + heading + \
                          "&lt;/h" + level[page_order] + "&gt;" + page_content_list[i]
        # 利用 cgi.escape() 將 specialchar 轉成只能顯示的格式
        outstring += last_page + " " + next_page + "&lt;br /&gt;" + tinymce_editor(directory, cgi.escape(pagedata), page_order)
     
    # edit=0 for viewpage
    if edit == 0:
        return set_css2() + '''&lt;div class='container'&gt;&lt;nav&gt;
        '''+ \
        directory + "&lt;div id=\"tipue_search_content\"&gt;" + return_content + \
        '''&lt;/div&gt;
         
    &lt;!-- footer --&gt;
      &lt;div class="container"&gt;
        &lt;div class="row pt-3 mx-auto"&gt;
            &lt;p&gt;
            &lt;!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --&gt;
            Copyright ©&lt;script&gt;document.write(new Date().getFullYear());&lt;/script&gt; All rights reserved | This template is made with &lt;i class="icon-heart" aria-hidden="true"&gt;&lt;/i&gt; by &lt;a href="https://colorlib.com" target="_blank" &gt;Colorlib&lt;/a&gt;
            &lt;!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --&gt;
            &lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;!-- for footer --&gt;
     
        &lt;/div&gt; &lt;!-- for site wrap --&gt;
            &lt;!-- &lt;script src="../static/chimper/js/jquery-3.3.1.min.js"&gt;&lt;/script&gt; --&gt;
            &lt;script src="../static/chimper/js/jquery-migrate-3.0.1.min.js"&gt;&lt;/script&gt;
            &lt;script src="../static/chimper/js/jquery-ui.js"&gt;&lt;/script&gt;
            &lt;script src="../static/chimper/js/popper.min.js"&gt;&lt;/script&gt;
            &lt;script src="../static/chimper/js/bootstrap.min.js"&gt;&lt;/script&gt;
            &lt;script src="../static/chimper/js/owl.carousel.min.js"&gt;&lt;/script&gt;
            &lt;script src="../static/chimper/js/jquery.stellar.min.js"&gt;&lt;/script&gt;
            &lt;script src="../static/chimper/js/jquery.countdown.min.js"&gt;&lt;/script&gt;
            &lt;script src="../static/chimper/js/jquery.magnific-popup.min.js"&gt;&lt;/script&gt;
            &lt;script src="../static/chimper/js/bootstrap-datepicker.min.js"&gt;&lt;/script&gt;
            &lt;script src="../static/chimper/js/aos.js"&gt;&lt;/script&gt;
            &lt;!--
            &lt;script src="../static/chimper/js/typed.js"&gt;&lt;/script&gt;
                    &lt;script&gt;
                    var typed = new Typed('.typed-words', {
                    strings: ["Web Apps"," WordPress"," Mobile Apps"],
                    typeSpeed: 80,
                    backSpeed: 80,
                    backDelay: 4000,
                    startDelay: 1000,
                    loop: true,
                    showCursor: true
                    });
                    &lt;/script&gt;
            --&gt;
            &lt;script src="../static/chimper/js/main.js"&gt;&lt;/script&gt;
        &lt;/body&gt;&lt;/html&gt;
        '''
    # enter edit mode
    else:
        # check if administrator
        if not isAdmin():
            redirect(url_for('login'))
        else:
            if len(page_order_list) &gt; 1:
                # 若碰到重複頁面頁印, 且要求編輯, 則導向 edit_page
                #return redirect("/edit_page")
                for i in range(len(page_order_list)):
                    outstring_duplicate += outstring_list[i] + "&lt;br /&gt;&lt;hr&gt;"
                return outstring_duplicate
            else:
            #pagedata = "&lt;h" + level[page_order]+"&gt;" + heading + "&lt;/h" + level[page_order] + "&gt;" + search_content(head, page, heading)
            #outstring = last_page + " " + next_page + "&lt;br /&gt;" + tinymce_editor(directory, cgi.escape(pagedata), page_order)
                return outstring
 
 
@app.route('/image_delete_file', methods=['POST'])
def image_delete_file():
    if not isAdmin():
        return redirect("/login")
    filename = request.form['filename']
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
    if filename is None:
        outstring = "no file selected!"
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                 directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Delete Error&lt;/h1&gt;" + \
                 outstring + "&lt;br/&gt;&lt;br /&gt;&lt;/body&gt;&lt;/html&gt;"
    outstring = "delete all these files?&lt;br /&gt;&lt;br /&gt;"
    outstring += "&lt;form method='post' action='image_doDelete'&gt;"
    # only one file is selected
    if isinstance(filename, str):
        outstring += filename + "&lt;input type='hidden' name='filename' value='" + \
                          filename + "'&gt;&lt;br /&gt;"
    else:
        # multiple files selected
        for index in range(len(filename)):
            outstring += filename[index] + "&lt;input type='hidden' name='filename' value='" + \
                              filename[index] + "'&gt;&lt;br /&gt;"
    outstring += "&lt;br /&gt;&lt;input type='submit' value='delete'&gt;&lt;/form&gt;"
 
    return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
             directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Download List&lt;/h1&gt;" + \
             outstring + "&lt;br/&gt;&lt;br /&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
@app.route('/image_doDelete', methods=['POST'])
def image_doDelete():
    if not isAdmin():
        return redirect("/login")
    # delete files
    filename = request.form['filename']
    outstring = "all these files will be deleted:&lt;br /&gt;&lt;br /&gt;"
    # only select one file
    if isinstance(filename, str):
        try:
            os.remove(image_dir + "/" + filename)
            outstring += filename + " deleted!"
        except:
            outstring += filename + "Error, can not delete files!&lt;br /&gt;"
    else:
        # multiple files selected
        for index in range(len(filename)):
            try:
                os.remove(image_dir + "/" + filename[index])
                outstring += filename[index] + " deleted!&lt;br /&gt;"
            except:
                outstring += filename[index] + "Error, can not delete files!&lt;br /&gt;"
 
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
 
    return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
             directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Image List&lt;/h1&gt;" + \
             outstring + "&lt;br/&gt;&lt;br /&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
@app.route('/image_list', methods=['GET'])
def image_list():
    if not isAdmin():
        return redirect("/login")
    else:
        if not request.args.get('edit'):
            edit= 1
        else:
            edit = request.args.get('edit')
        if not request.args.get('page'):
            page = 1
        else:
            page = request.args.get('page')
        if not request.args.get('item_per_page'):
            item_per_page = 10
        else:
            item_per_page = request.args.get('item_per_page')
        if not request.args.get('keyword'):
            keyword = ""
        else:
            keyword = request.args.get('keyword')
            session['image_keyword'] = keyword
    files = os.listdir(image_dir)
    if keyword is not "":
        files = [elem for elem in files if str(keyword) in elem]
    files.sort()
    total_rows = len(files)
    totalpage = math.ceil(total_rows/int(item_per_page))
    starti = int(item_per_page) * (int(page) - 1) + 1
    endi = starti + int(item_per_page) - 1
    outstring = "&lt;form method='post' action='image_delete_file'&gt;"
    notlast = False
    if total_rows &gt; 0:
        outstring += "&lt;br /&gt;"
        if (int(page) * int(item_per_page)) &lt; total_rows:
            notlast = True
        if int(page) &gt; 1:
            outstring += "&lt;a href='"
            outstring += "image_list?&amp;page=1&amp;item_per_page=" + \
                              str(item_per_page) + "&amp;keyword=" + str(session.get('image_keyword'))
            outstring += "'&gt;&lt;&lt;&lt;/a&gt; "
            page_num = int(page) - 1
            outstring += "&lt;a href='"
            outstring += "image_list?&amp;page=" + str(page_num) + \
                              "&amp;item_per_page=" + str(item_per_page) + \
                              "&amp;keyword=" + str(session.get('image_keyword'))
            outstring += "'&gt;Previous&lt;/a&gt; "
        span = 10
        for index in range(int(page)-span, int(page)+span):
            if index &gt;= 0 and index &lt; totalpage:
                page_now = index + 1
                if page_now == int(page):
                    outstring += "&lt;font size='+1' color='red'&gt;" + str(page) + " &lt;/font&gt;"
                else:
                    outstring += "&lt;a href='"
                    outstring += "image_list?&amp;page=" + str(page_now) + \
                                      "&amp;item_per_page=" + str(item_per_page) + \
                                      "&amp;keyword=" + str(session.get('image_keyword'))
                    outstring += "'&gt;" + str(page_now) + "&lt;/a&gt; "
 
        if notlast == True:
            nextpage = int(page) + 1
            outstring += " &lt;a href='"
            outstring += "image_list?&amp;page=" + str(nextpage) + \
                              "&amp;item_per_page=" + str(item_per_page) + \
                              "&amp;keyword=" + str(session.get('image_keyword'))
            outstring += "'&gt;Next&lt;/a&gt;"
            outstring += " &lt;a href='"
            outstring += "image_list?&amp;page=" + str(totalpage) + \
                              "&amp;item_per_page=" + str(item_per_page) + \
                              "&amp;keyword=" + str(session.get('image_keyword'))
            outstring += "'&gt;&gt;&gt;&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;"
        if (int(page) * int(item_per_page)) &lt; total_rows:
            notlast = True
            outstring += imagelist_access_list(files, starti, endi) + "&lt;br /&gt;"
        else:
            outstring += "&lt;br /&gt;&lt;br /&gt;"
            outstring += imagelist_access_list(files, starti, total_rows) + "&lt;br /&gt;"
         
        if int(page) &gt; 1:
            outstring += "&lt;a href='"
            outstring += "image_list?&amp;page=1&amp;item_per_page=" + \
                              str(item_per_page) + "&amp;keyword=" + str(session.get('image_keyword'))
            outstring += "'&gt;&lt;&lt;&lt;/a&gt; "
            page_num = int(page) - 1
            outstring += "&lt;a href='"
            outstring += "image_list?&amp;page=" + str(page_num) + \
                              "&amp;item_per_page=" + str(item_per_page) + \
                              "&amp;keyword=" + str(session.get('image_keyword'))
            outstring += "'&gt;Previous&lt;/a&gt; "
        span = 10
        for index in range(int(page)-span, int(page)+span):
            if index &gt;=0 and index &lt; totalpage:
                page_now = index + 1
                if page_now == int(page):
                    outstring += "&lt;font size='+1' color='red'&gt;" + str(page) + " &lt;/font&gt;"
                else:
                    outstring += "&lt;a href='"
                    outstring += "image_list?&amp;page=" + str(page_now) + \
                                      "&amp;item_per_page=" + str(item_per_page) + \
                                      "&amp;keyword=" + str(session.get('image_keyword'))
                    outstring += "'&gt;"+str(page_now) + "&lt;/a&gt; "
        if notlast == True:
            nextpage = int(page) + 1
            outstring += " &lt;a href='"
            outstring += "image_list?&amp;page=" + str(nextpage) + \
                              "&amp;item_per_page=" + str(item_per_page) + \
                              "&amp;keyword=" + str(session.get('image_keyword'))
            outstring += "'&gt;Next&lt;/a&gt;"
            outstring += " &lt;a href='"
            outstring += "image_list?&amp;page=" + str(totalpage) + \
                              "&amp;item_per_page=" + str(item_per_page) + \
                              "&amp;keyword=" + str(session.get('image_keyword'))
            outstring += "'&gt;&gt;&gt;&lt;/a&gt;"
    else:
        outstring += "no data!"
    outstring += "&lt;br /&gt;&lt;br /&gt;&lt;input type='submit' value='delete'&gt;&lt;input type='reset' value='reset'&gt;&lt;/form&gt;"
 
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
 
    return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;"+ \
             directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Image List&lt;/h1&gt;" + \
             outstring + "&lt;br/&gt;&lt;br /&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
@app.route('/imageaxupload', methods=['POST'])
# ajax jquery chunked file upload for flask
def imageaxupload():
    if isAdmin():
        # need to consider if the uploaded filename already existed.
        # right now all existed files will be replaced with the new files
        filename = request.args.get("ax-file-name")
        flag = request.args.get("start")
        if flag == "0":
            file = open(_curdir + "/images/" + filename, "wb")
        else:
            file = open(_curdir + "/images/" + filename, "ab")
        file.write(request.stream.read())
        file.close()
        return "image files uploaded!"
    else:
        return redirect("/login")
 
 
def imagelist_access_list(files, starti, endi):
    # different extension files, associated links were provided
    # popup window to view images, video or STL files, other files can be downloaded directly
    # files are all the data to list, from starti to endi
    # add file size
    outstring = ""
    for index in range(int(starti)-1, int(endi)):
        fileName, fileExtension = os.path.splitext(files[index])
        fileExtension = fileExtension.lower()
        fileSize = sizeof_fmt(os.path.getsize(image_dir + "/" + files[index]))
        # images files
        if fileExtension == ".png" or fileExtension == ".jpg" or fileExtension == ".gif":
            outstring += '&lt;input type="checkbox" name="filename" value="' + files[index] + \
                              '"&gt;&lt;a href="javascript:;" onClick="window.open(\'/images/' + \
                              files[index] + '\',\'images\', \'catalogmode\',\'scrollbars\')"&gt;' + \
                              files[index] + '&lt;/a&gt; (' + str(fileSize) + ')&lt;br /&gt;'
    return outstring
 
 
# 與 file_selector 搭配的取影像檔程式
def imageselect_access_list(files, starti, endi):
    outstring = '''&lt;head&gt;
&lt;style&gt;
a.xhfbfile {padding: 0 2px 0 0; line-height: 1em;}
a.xhfbfile img{border: none; margin: 6px;}
a.xhfbfile span{display: none;}
a.xhfbfile:hover span{
    display: block;
    position: relative;
    left: 150px;
    border: #aaa 1px solid;
    padding: 2px;
    background-color: #ddd;
}
a.xhfbfile:hover{
    background-color: #ccc;
    opacity: .9;
    cursor:pointer;
}
&lt;/style&gt;
&lt;/head&gt;
'''
    for index in range(int(starti)-1, int(endi)):
        fileName, fileExtension = os.path.splitext(files[index])
        fileSize = os.path.getsize(image_dir+"/"+files[index])
        outstring += '''&lt;a class="xhfbfile" href="#" onclick='window.setLink("/images/'''+ \
                          files[index] + '''",0); return false;'&gt;''' + \
                          files[index] + '''&lt;span style="position: absolute; z-index: 4;"&gt;&lt;br /&gt; \
                          &lt;img src="./../images/''' + files[index] + '''" width="150px"/&gt;&lt;/span&gt;&lt;/a&gt; \
                          (''' + str(sizeof_fmt(fileSize)) + ''')&lt;br /&gt;'''
    return outstring
 
 
@app.route('/imageuploadform', defaults={'edit': 1})
@app.route('/imageuploadform/&lt;path:edit&gt;')
def imageuploadform(edit):
    """image files upload form"""
    if isAdmin():
        head, level, page = parse_content()
        directory = render_menu(head, level, page)
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                 directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;image files upload&lt;/h1&gt;" + '''
&lt;script src="./../static/jquery.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script src="./../static/axuploader.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script&gt;
$(document).ready(function(){
$('.prova').axuploader({url:'imageaxupload', allowExt:['jpg','png','gif'],
finish:function(x,files)
    {
        alert('All files have been uploaded: '+files);
    },
enable:true,
remotePath:function(){
return 'images/';
}
});
});
&lt;/script&gt;
&lt;div class="prova"&gt;&lt;/div&gt;
&lt;input type="button" onclick="$('.prova').axuploader('disable')" value="asd" /&gt;
&lt;input type="button" onclick="$('.prova').axuploader('enable')" value="ok" /&gt;
&lt;/section&gt;&lt;/body&gt;&lt;/html&gt;
'''
    else:
        return redirect("/login")
 
 
@app.route('/')
def index():
    head, level, page = parse_content()
    # 2018.12.13, 將空白轉為"+" 號, 會導致連線錯誤, 改為直接取頁面標題
    #return redirect("/get_page/" + urllib.parse.quote_plus(head[0], encoding="utf-8"))
    return redirect("/get_page/" + head[0])
    # the following will never execute
    directory = render_menu(head, level, page)
    if heading is None:
        heading = head[0]
    # 因為同一 heading 可能有多頁, 因此不可使用 head.index(heading) 搜尋 page_order
    page_order_list, page_content_list = search_content(head, page, heading)
    return_content = ""
    for i in range(len(page_order_list)):
        #page_order = head.index(heading)
        page_order = page_order_list[page_order_list[i]]
        if page_order == 0:
            last_page = ""
        else:
            last_page = head[page_order-1] + " &lt;&lt; &lt;a href='/get_page/" + \
                             head[page_order-1] + "'&gt;Previous&lt;/a&gt;"
        if page_order == len(head) - 1:
            # no next page
            next_page = ""
        else:
            next_page = "&lt;a href='/get_page/" + head[page_order+1] + \
                              "'&gt;Next&lt;/a&gt; &gt;&gt; " + head[page_order+1]
        return_content += last_page + " " + next_page + "&lt;br /&gt;&lt;h1&gt;" + \
                                  heading + "&lt;/h1&gt;" + page_content_list[page_order_list[i]] + \
                                  "&lt;br /&gt;" + last_page + " " + next_page
 
    return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
             directory + "&lt;/nav&gt;&lt;section&gt;" + return_content + "&lt;/section&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
def isAdmin():
    if session.get('admin') == 1:
            return True
    else:
        return False
 
 
# use to check directory variable data
@app.route('/listdir')
def listdir():
    return download_dir + "," + config_dir
 
 
@app.route('/load_list')
def load_list(item_per_page=5, page=1, filedir=None, keyword=None):
    files = os.listdir(config_dir+filedir+"_programs/")
    if keyword is None:
        pass
    else:
        session['search_keyword'] = keyword
        files = [s for s in files if keyword in s]
    total_rows = len(files)
    totalpage = math.ceil(total_rows/int(item_per_page))
    starti = int(item_per_page) * (int(page) - 1) + 1
    endi = starti + int(item_per_page) - 1
    outstring = '''&lt;script&gt;
function keywordSearch(){
    var oform = document.forms["searchform"];
    // 取elements集合中 name 屬性為 keyword 的值
    var getKeyword = oform.elements.keyword.value;
    // 改為若表單為空, 則列出全部資料
    //if(getKeyword != ""){
        window.location = "?brython&amp;keyword="+getKeyword;
    //}
}
&lt;/script&gt;
    &lt;form name="searchform"&gt;
    &lt;input type="text" id="keyword" /&gt;
    &lt;input type="button" id="send" value="查詢" onClick="keywordSearch()"/&gt; 
    &lt;/form&gt;
'''
    outstring += "&lt;form name='filelist' method='post' action=''&gt;"
    notlast = False
    if total_rows &gt; 0:
        # turn off the page selector on top
        '''
        outstring += "&lt;br /&gt;"
        if (int(page) * int(item_per_page)) &lt; total_rows:
            notlast = True
        if int(page) &gt; 1:
            outstring += "&lt;a href='"
            outstring += "brython?&amp;page=1&amp;item_per_page="+str(item_per_page)+"&amp;keyword="+str(session.get('search_keyword'))
            outstring += "'&gt;{{&lt;/a&gt; "
            page_num = int(page) - 1
            outstring += "&lt;a href='"
            outstring += "brython?&amp;page="+str(page_num)+"&amp;item_per_page="+str(item_per_page)+"&amp;keyword="+str(session.get('search_keyword'))
            outstring += "'&gt;Previous&lt;/a&gt; "
        span = 10
        for index in range(int(page)-span, int(page)+span):
            if index&gt;= 0 and index&lt; totalpage:
                page_now = index + 1 
                if page_now == int(page):
                    outstring += "&lt;font size='+1' color='red'&gt;"+str(page)+" &lt;/font&gt;"
                else:
                    outstring += "&lt;a href='"
                    outstring += "brython?&amp;page="+str(page_now)+"&amp;item_per_page="+str(item_per_page)+"&amp;keyword="+str(session.get('search_keyword'))
                    outstring += "'&gt;"+str(page_now)+"&lt;/a&gt; "
 
        if notlast == True:
            nextpage = int(page) + 1
            outstring += " &lt;a href='"
            outstring += "brython?&amp;page="+str(nextpage)+"&amp;item_per_page="+str(item_per_page)+"&amp;keyword="+str(session.get('search_keyword'))
            outstring += "'&gt;Next&lt;/a&gt;"
            outstring += " &lt;a href='"
            outstring += "brython?&amp;page="+str(totalpage)+"&amp;item_per_page="+str(item_per_page)+"&amp;keyword="+str(session.get('search_keyword'))
            outstring += "'&gt;}}&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;"
        '''
        if (int(page) * int(item_per_page)) &lt; total_rows:
            notlast = True
            outstring += loadlist_access_list(files, starti, endi, filedir) + "&lt;br /&gt;"
        else:
            outstring += "&lt;br /&gt;&lt;br /&gt;"
            outstring += loadlist_access_list(files, starti, total_rows, filedir) + "&lt;br /&gt;"
         
        if int(page) &gt; 1:
            outstring += "&lt;a href='"
            outstring += "/"+filedir + "?&amp;page=1&amp;item_per_page=" + str(item_per_page)+"&amp;keyword=" + str(session.get('search_keyword'))
            outstring += "'&gt;{{&lt;/a&gt; "
            page_num = int(page) - 1
            outstring += "&lt;a href='"
            outstring += "/"+filedir + "?&amp;page=" + str(page_num)+"&amp;item_per_page=" + \
                              str(item_per_page) + "&amp;keyword=" + str(session.get('search_keyword'))
            outstring += "'&gt;Previous&lt;/a&gt; "
        span = 5
        for index in range(int(page)-span, int(page)+span):
        #for ($j=$page-$range;$j&lt;$page+$range;$j++)
            if index &gt;=0 and index &lt; totalpage:
                page_now = index + 1
                if page_now == int(page):
                    outstring += "&lt;font size='+1' color='red'&gt;" + str(page) + " &lt;/font&gt;"
                else:
                    outstring += "&lt;a href='"
                    outstring += "/" + filedir + "?&amp;page=" + str(page_now) + \
                                      "&amp;item_per_page=" + str(item_per_page) + \
                                      "&amp;keyword="+str(session.get('search_keyword'))
                    outstring += "'&gt;" + str(page_now) + "&lt;/a&gt; "
        if notlast == True:
            nextpage = int(page) + 1
            outstring += " &lt;a href='"
            outstring += "/" + filedir + "?&amp;page=" + str(nextpage) + \
                              "&amp;item_per_page=" + str(item_per_page) + \
                              "&amp;keyword=" + str(session.get('search_keyword'))
            outstring += "'&gt;Next&lt;/a&gt;"
            outstring += " &lt;a href='"
            outstring += "/" + filedir + "?&amp;page=" + str(totalpage) + \
                              "&amp;item_per_page=" + str(item_per_page) + \
                              "&amp;keyword=" + str(session.get('search_keyword'))
            outstring += "'&gt;}}&lt;/a&gt;"
    else:
        outstring += "no data!"
    #outstring += "&lt;br /&gt;&lt;br /&gt;&lt;input type='submit' value='load'&gt;&lt;input type='reset' value='reset'&gt;&lt;/form&gt;"
    outstring += "&lt;br /&gt;&lt;br /&gt;&lt;/form&gt;"
 
    return outstring
 
 
def loadlist_access_list(files, starti, endi, filedir):
    # different extension files, associated links were provided
    # popup window to view images, video or STL files, other files can be downloaded directly
    # files are all the data to list, from starti to endi
    # add file size
    outstring = ""
    for index in range(int(starti)-1, int(endi)):
        fileName, fileExtension = os.path.splitext(files[index])
        fileExtension = fileExtension.lower()
        fileSize = sizeof_fmt(os.path.getsize(config_dir + filedir + "_programs/" + files[index]))
        # images files
        if fileExtension == ".png" or fileExtension == ".jpg" or fileExtension == ".gif":
            outstring += '&lt;input type="checkbox" name="filename" value="' + files[index] + \
                              '"&gt;&lt;a href="javascript:;" onClick="window.open(\'/downloads/'+ \
                            files[index] + '\',\'images\', \'catalogmode\',\'scrollbars\')"&gt;' + files[index] + '&lt;/a&gt; (' + str(fileSize)+')&lt;br /&gt;'
        # stl files
        elif fileExtension == ".stl":
            outstring += '&lt;input type="checkbox" name="filename" value="' + files[index] + '"&gt;&lt;a href="javascript:;" onClick="window.open(\'/static/viewstl.html?src=/downloads/' + \
            files[index] + '\',\'images\', \'catalogmode\',\'scrollbars\')"&gt;' + files[index] + '&lt;/a&gt; ('+str(fileSize)+')&lt;br /&gt;'
        # flv files
        elif fileExtension == ".flv":
            outstring += '&lt;input type="checkbox" name="filename" value="' + files[index] + '"&gt;&lt;a href="javascript:;" onClick="window.open(\'/flvplayer?filepath=/downloads/' + \
            files[index]+'\',\'images\', \'catalogmode\',\'scrollbars\')"&gt;' + files[index] + '&lt;/a&gt; ('+str(fileSize)+')&lt;br /&gt;'
        # py files
        elif fileExtension == ".py":
            outstring += '&lt;input type="radio" name="filename" value="' + files[index] + '"&gt;' + files[index] + ' (' + str(fileSize) + ')&lt;br /&gt;'
        # direct download files
        else:
            outstring += "&lt;input type='checkbox' name='filename' value='" + files[index] + \
                             "'&gt;&lt;a href='/" + filedir + "_programs/" + files[index] + "'&gt;" + files[index] + "&lt;/a&gt; (" + str(fileSize) + ")&lt;br /&gt;"
    return outstring
 
 
@app.route('/login')
def login():
    """login routine"""
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
    if not isAdmin():
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                 directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Login&lt;/h1&gt;&lt;form method='post' action='checkLogin'&gt; \
                Password:&lt;input type='password' name='password'&gt; \
    &lt;input type='submit' value='login'&gt;&lt;/form&gt; \
    &lt;/section&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"
    else:
        return redirect('/edit_page')
 
 
@app.route('/logout')
def logout():
    session.pop('admin' , None)
    flash('已經登出!')
    return redirect(url_for('login'))
 
 
def parse_config():
    if not os.path.isfile(config_dir+"config"):
        # create config file if there is no config file
        # default password is admin
        password="admin"
        hashed_password = hashlib.sha512(password.encode('utf-8')).hexdigest()
        with open(config_dir + "config", "w", encoding="utf-8") as f:
            f.write("siteTitle:CMSimfly \npassword:"+hashed_password)
    config = file_get_contents(config_dir + "config")
    config_data = config.split("\n")
    site_title = config_data[0].split(":")[1]
    password = config_data[1].split(":")[1]
    return site_title, password
 
 
def _remove_h123_attrs(soup):
    tag_order = 0
    for tag in soup.find_all(['h1', 'h2', 'h3']):
        # 假如標註內容沒有字串
        #if len(tag.text) == 0:
        if len(tag.contents) ==0:
            # 且該標註為排序第一
            if tag_order == 0:
                tag.string = "First"
            else:
                # 若該標註非排序第一, 則移除無內容的標題標註
                tag.extract()
        # 針對單一元件的標題標註
        elif len(tag.contents) == 1:
            # 若內容非為純文字, 表示內容為其他標註物件
            if tag.get_text() == "":
                # 且該標註為排序第一
                if tag_order == 0:
                    # 在最前方插入標題
                    tag.insert_before(soup.new_tag('h1', 'First'))
                else:
                    # 移除 h1, h2 或 h3 標註, 只留下內容
                    tag.replaceWithChildren()
            # 表示單一元件的標題標註, 且標題為單一字串者
            else:
                # 判定若其排序第一, 則將 tag.name 為 h2 或 h3 者換為 h1
                if tag_order == 0:
                    tag.name = "h1"
            # 針對其餘單一字串內容的標註, 則保持原樣
        # 針對內容一個以上的標題標註
        #elif len(tag.contents) &gt; 1:
        else:
            # 假如該標註內容長度大於 1
            # 且該標註為排序第一
            if tag_order == 0:
                # 先移除 h1, h2 或 h3 標註, 只留下內容
                #tag.replaceWithChildren()
                # 在最前方插入標題
                tag.insert_before(soup.new_tag('h1', 'First'))
            else:
                # 只保留標題內容,  去除 h1, h2 或 h3 標註
                # 為了與前面的內文區隔, 先在最前面插入 br 標註
                tag.insert_before(soup.new_tag('br'))
                # 再移除非排序第一的 h1, h2 或 h3 標註, 只留下內容
                tag.replaceWithChildren()
        tag_order = tag_order + 1
 
    return soup
 
def parse_content():
    """use bs4 and re module functions to parse content.htm"""
    #from pybean import Store, SQLiteWriter
    # if no content.db, create database file with cms table
    '''
    if not os.path.isfile(config_dir+"content.db"):
        library = Store(SQLiteWriter(config_dir+"content.db", frozen=False))
        cms = library.new("cms")
        cms.follow = 0
        cms.title = "head 1"
        cms.content = "content 1"
        cms.memo = "first memo"
        library.save(cms)
        library.commit()
    '''
    # if no content.htm, generate a head 1 and content 1 file
    if not os.path.isfile(config_dir+"content.htm"):
        # create content.htm if there is no content.htm
        with open(config_dir + "content.htm", "w", encoding="utf-8") as f:
            f.write("&lt;h1&gt;head 1&lt;/h1&gt;content 1")
    subject = file_get_contents(config_dir+"content.htm")
    # deal with content without content
    if subject == "":
        # create content.htm if there is no content.htm
        with open(config_dir + "content.htm", "w", encoding="utf-8") as f:
            f.write("&lt;h1&gt;head 1&lt;/h1&gt;content 1")
        subject = "&lt;h1&gt;head 1&lt;/h1&gt;content 1"
    # initialize the return lists
    head_list = []
    level_list = []
    page_list = []
    # make the soup out of the html content
    soup = bs4.BeautifulSoup(subject, 'html.parser')
    # 嘗試解讀各種情況下的標題
    soup = _remove_h123_attrs(soup)
    # 改寫 content.htm 後重新取 subject
    with open(config_dir + "content.htm", "wb") as f:
        f.write(soup.encode("utf-8"))
    subject = file_get_contents(config_dir+"content.htm")
    # get all h1, h2, h3 tags into list
    htag= soup.find_all(['h1', 'h2', 'h3'])
    n = len(htag)
    # get the page content to split subject using each h tag
    temp_data = subject.split(str(htag[0]))
    if len(temp_data) &gt; 2:
        subject = str(htag[0]).join(temp_data[1:])
    else:
        subject = temp_data[1]
    if n &gt;1:
            # i from 1 to i-1
            for i in range(1, len(htag)):
                head_list.append(htag[i-1].text.strip())
                # use name attribute of h* tag to get h1, h2 or h3
                # the number of h1, h2 or h3 is the level of page menu
                level_list.append(htag[i-1].name[1])
                temp_data = subject.split(str(htag[i]))
                if len(temp_data) &gt; 2:
                    subject = str(htag[i]).join(temp_data[1:])
                else:
                    subject = temp_data[1]
                # cut the other page content out of htag from 1 to i-1
                cut = temp_data[0]
                # add the page content
                page_list.append(cut)
    # last i
    # add the last page title
    head_list.append(htag[n-1].text.strip())
    # add the last level
    level_list.append(htag[n-1].name[1])
    temp_data = subject.split(str(htag[n-1]))
    # the last subject
    subject = temp_data[0]
    # cut the last page content out
    cut = temp_data[0]
    # the last page content
    page_list.append(cut)
    return head_list, level_list, page_list
 
def render_menu(head, level, page, sitemap=0):
    '''允許使用者在 h1 標題後直接加上 h3 標題, 或者隨後納入 h4 之後作為標題標註'''
    directory = ""
    # 從 level 數列第一個元素作為開端
    current_level = level[0]
    # 若是 sitemap 則僅列出樹狀架構而沒有套用 css3menu 架構
    if sitemap:
        directory += "&lt;ul&gt;"
    else:
        directory += "&lt;ul id='css3menu1' class='topmenu'&gt;"
    # 逐一配合 level 數列中的各標題階次, 一一建立對應的表單或 sitemap
    for index in range(len(head)):
        # 用 this_level 取出迴圈中逐一處理的頁面對應層級, 注意取出值為 str
        this_level = level[index]
        # 若處理中的層級比上一層級高超過一層, 則將處理層級升級 (處理 h1 後直接接 h3 情況)
        if (int(this_level) - int(current_level)) &gt; 1:
            #this_level = str(int(this_level) - 1)
            # 考慮若納入 h4 也作為標題標註, 相鄰層級可能大於一層, 因此直接用上一層級 + 1
            this_level = str(int(current_level) + 1)
        # 若處理的階次比目前已經處理的階次大, 表示位階較低
        # 其實當 level[0] 完全不會報告此一區塊
        # 從正在處理的標題階次與前一個元素比對, 若階次低, 則要加入另一區段的 unordered list 標頭
        # 兩者皆為 str 會轉為整數後比較
        if this_level &gt; current_level:
            directory += "&lt;ul&gt;"
            directory += "&lt;li&gt;&lt;a href='/get_page/" + head[index] + "'&gt;" + head[index] + "&lt;/a&gt;"
        # 假如正在處理的標題與前一個元素同位階, 則必須再判定是否為另一個 h1 的樹狀頭
        elif this_level == current_level:
            # 若正在處理的標題確實為樹狀頭, 則標上樹狀頭開始標註
            if this_level == 1:
                # 這裡還是需要判定是在建立 sitemap 模式或者選單模式
                if sitemap:
                    directory += "&lt;li&gt;&lt;a href='/get_page/" + head[index] + "'&gt;" + head[index]+"&lt;/a&gt;"
                else:
                    directory += "&lt;li class='topmenu'&gt;&lt;a href='/get_page/" + head[index] + "'&gt;" + head[index] + "&lt;/a&gt;"
            #  假如不是樹狀頭, 則只列出對應的 list
            else:
                directory += "&lt;li&gt;&lt;a href='/get_page/" + head[index] + "'&gt;" + head[index] + "&lt;/a&gt;"
        # 假如正處理的元素比上一個元素位階更高, 必須要先關掉前面的低位階區段
        else:
            directory += "&lt;/li&gt;"*(int(current_level) - int(level[index]))
            directory += "&lt;/ul&gt;"*(int(current_level) - int(level[index]))
            if this_level == 1:
                if sitemap:
                    directory += "&lt;li&gt;&lt;a href='/get_page/" + head[index] + "'&gt;" + head[index] + "&lt;/a&gt;"
                else:
                    directory += "&lt;li class='topmenu'&gt;&lt;a href='/get_page/" + head[index] + "'&gt;" + head[index] + "&lt;/a&gt;"
            else:
                directory += "&lt;li&gt;&lt;a href='/get_page/" + head[index] + "'&gt;" + head[index] + "&lt;/a&gt;"
        current_level = this_level
    directory += "&lt;/li&gt;&lt;/ul&gt;"
    return directory
def render_menu2(head, level, page, sitemap=0):
    """render menu for static site"""
    site_title, password = parse_config()
    directory = '''
    &lt;div class="site-wrap"&gt;
 
    &lt;div class="site-mobile-menu"&gt;
      &lt;div class="site-mobile-menu-header"&gt;
        &lt;div class="site-mobile-menu-close mt-3"&gt;
          &lt;span class="icon-close2 js-menu-toggle"&gt;&lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="site-mobile-menu-body"&gt;&lt;/div&gt;
    &lt;/div&gt;
     
            &lt;header class="site-navbar py-4 bg-white" role="banner"&gt;
              &lt;div class="container-fluid"&gt;
                &lt;div class="row align-items-center"&gt;
                &lt;h1&gt;''' + site_title + '''&lt;/h1&gt;
                &lt;div class="pl-4"&gt;
                    &lt;form&gt;
                    &lt;input type="text" placeholder="Search" name="q" id="tipue_search_input" pattern=".{2,}" title="At least 2 characters" required&gt;
                    &lt;/form&gt;
                &lt;/div&gt;
                  &lt;!-- &lt;div class="col-11 col-xl-2"&gt;
                    &lt;h1 class="mb-0 site-logo"&gt;&lt;a href="index.html" class="text-black h2 mb-0"&gt;''' + site_title + '''&lt;/a&gt;&lt;/h1&gt; 
                  &lt;/div&gt;
                  --&gt;
                  &lt;div class="col-12 col-md-10 d-none d-xl-block"&gt;
                    &lt;nav class="site-navigation position-relative text-right" role="navigation"&gt;
    '''
     
    # 從 level 數列第一個元素作為開端, 第一個一定非 level 1 不可
    current_level = level[0]
    # 若是 sitemap 則僅列出樹狀架構而沒有套用 css3menu 架構
    if sitemap:
        directory += '''&lt;ul&gt;
&lt;li&gt;
&lt;form&gt;
&lt;div class="tipue_search_group"&gt;
&lt;input type="text" name="q" id="tipue_search_input" pattern=".{2,}" title="At least 2 characters" required&gt;&lt;button type="submit" class="tipue_search_button"&gt;&lt;div class="tipue_search_icon"&gt;⚲&lt;/div&gt;&lt;/button&gt;
&lt;/div&gt;
&lt;/form&gt;
&lt;/li&gt;
        '''
    else:
        directory += '''&lt;ul class='site-menu js-clone-nav mr-auto d-none d-lg-block'&gt;'''
    # 納入主頁與表單
    directory += '''
                        &lt;li class="active has-children"&gt;&lt;a href="index.html"&gt;Home&lt;/a&gt;
                        &lt;ul class="dropdown"&gt;
                            &lt;li&gt;&lt;a href="sitemap.html"&gt;Site Map&lt;/a&gt;&lt;/li&gt;
                            &lt;li&gt;&lt;a href="./../reveal/index.html"&gt;reveal&lt;/a&gt;&lt;/li&gt;
                            &lt;li&gt;&lt;a href="./../blog/index.html"&gt;blog&lt;/a&gt;&lt;/li&gt;
                        &lt;/ul&gt;
                      &lt;/li&gt;
                     '''
    # 逐一配合 level 數列中的各標題階次, 一一建立對應的表單或 sitemap
    for index in range(len(head)):
        # 用 this_level 取出迴圈中逐一處理的頁面對應層級, 注意取出值為 str
        this_level = level[index]
        # 若處理中的層級比上一層級高超過一層, 則將處理層級升級 (處理 h1 後直接接 h3 情況)
        if (int(this_level) - int(current_level)) &gt; 1:
            #this_level = str(int(this_level) - 1)
            # 考慮若納入 h4 也作為標題標註, 相鄰層級可能大於一層, 因此直接用上一層級 + 1
            this_level = str(int(current_level) + 1)
        # 若處理的階次比目前已經處理的階次大, 表示位階較低
        # 其實當 level[0] 完全不會報告此一區塊
        # 從正在處理的標題階次與前一個元素比對, 若階次低, 則要加入另一區段的 unordered list 標頭
        # 兩者皆為 str 會轉為整數後比較
        # 目前的位階在上一個標題之後
        if this_level &gt; current_level:
            directory += "&lt;ul class='dropdown'&gt;"
            # 是否加上 class=has-children, 視下一個而定
            # 目前處理的標題, 並不是最後一個, 因此有下一個標題待處理
            if index &lt; (len(head)-1):
                next_level = level[index+1]
                if this_level &lt; next_level:
                    # 表示要加上 class=dropdown
                    directory += "&lt;li class='has-children'&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
                else:
                    directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
            else:
                #表示為最後一個
                directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
        # 假如正在處理的標題與前一個元素同位階, 則必須再判定是否為另一個 h1 的樹狀頭
        # 目前標題與上一個標題相同
        elif this_level == current_level:
            # 是否加上 class=has-children, 視下一個而定
            # 目前處理的標題, 並不是最後一個, 因此有下一個標題待處理
            if index &lt; (len(head)-1):
                next_level = level[index+1]
                if this_level &lt; next_level:
                    # 表示要加上 class=dropdown
                    directory += "&lt;li class='has-children'&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
                else:
                    directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
            else:
                #表示為最後一個
                directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
        # 假如正處理的元素比上一個元素位階更高, 必須要先關掉前面的低位階區段
        else:
            directory += "&lt;/li&gt;"*(int(current_level) - int(level[index]))
            directory += "&lt;/ul&gt;"*(int(current_level) - int(level[index]))
            if index &lt; (len(head)-1):
                next_level = level[index+1]
                if this_level &lt; next_level:
                    # 表示要加上 class=dropdown
                    directory += "&lt;li class='has-children'&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
                else:
                    directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
            else:
                #表示為最後一個
                directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
        current_level = this_level
    directory += '''&lt;/li&gt;
                      &lt;/ul&gt;
                &lt;/nav&gt;
              &lt;/div&gt;
              &lt;div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"&gt;&lt;a href="#" class="site-menu-toggle js-menu-toggle text-black"&gt;&lt;span class="icon-menu h3"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;
              &lt;/div&gt;
 
            &lt;/div&gt;
          &lt;/div&gt;
           
        &lt;/header&gt;
    '''
    return directory
def render_menu3(head, level, page, sitemap=0):
    """render menu for static sitemap"""
    directory = ""
    current_level = level[0]
    if sitemap:
        directory += "&lt;ul&gt;"
    else:
        # before add tipue search function
        #directory += "&lt;ul id='css3menu1' class='topmenu'&gt;"
        directory += "&lt;ul id='css3menu1' class='topmenu'&gt;&lt;div class=\"tipue_search_group\"&gt;&lt;input style=\"width: 6vw;\" type=\"text\" name=\"q\" id=\"tipue_search_input\" pattern=\".{2,}\" title=\"Press enter key to search\" required&gt;&lt;/div&gt;"
    for index in range(len(head)):
        this_level = level[index]
        # 若處理中的層級比上一層級高超過一層, 則將處理層級升級 (處理 h1 後直接接 h3 情況)
        if (int(this_level) - int(current_level)) &gt; 1:
            #this_level = str(int(this_level) - 1)
            this_level = str(int(current_level) + 1)
        if this_level &gt; current_level:
            directory += "&lt;ul&gt;"
            #directory += "&lt;li&gt;&lt;a href='/get_page/"+head[index]+"'&gt;"+head[index]+"&lt;/a&gt;"
            # 改為連結到 content/標題.html
            directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
        elif this_level == current_level:
            if this_level == 1:
                if sitemap:
                    # 改為連結到 content/標題.html
                    #directory += "&lt;li&gt;&lt;a href='/get_page/"+head[index]+"'&gt;"+head[index]+"&lt;/a&gt;"
                    directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
                else:
                    #directory += "&lt;li class='topmenu'&gt;&lt;a href='/get_page/"+head[index]+"'&gt;"+head[index]+"&lt;/a&gt;"
                    directory += "&lt;li class='topmenu'&gt;&lt;a href='content/" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
            else:
                #directory += "&lt;li&gt;&lt;a href='/get_page/"+head[index]+"'&gt;"+head[index]+"&lt;/a&gt;"
                directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
        else:
            directory += "&lt;/li&gt;"*(int(current_level) - int(level[index]))
            directory += "&lt;/ul&gt;"*(int(current_level) - int(level[index]))
            if this_level == 1:
                if sitemap:
                    #directory += "&lt;li&gt;&lt;a href='/get_page/"+head[index]+"'&gt;"+head[index]+"&lt;/a&gt;"
                    directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
                else:
                    #directory += "&lt;li class='topmenu'&gt;&lt;a href='/get_page/"+head[index]+"'&gt;"+head[index]+"&lt;/a&gt;"
                    directory += "&lt;li class='topmenu'&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
            else:
                #directory += "&lt;li&gt;&lt;a href='/get_page/"+head[index]+"'&gt;"+head[index]+"&lt;/a&gt;"
                directory += "&lt;li&gt;&lt;a href='" + head[index] + ".html'&gt;" + head[index] + "&lt;/a&gt;"
        current_level = this_level
    directory += "&lt;/li&gt;&lt;/ul&gt;"
    return directory
@app.route('/saveConfig', methods=['POST'])
def saveConfig():
    if not isAdmin():
        return redirect("/login")
    site_title = request.form['site_title']
    password = request.form['password']
    password2 = request.form['password2']
    if site_title is None or password is None:
        return error_log("no content to save!")
    old_site_title, old_password = parse_config()
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
    if site_title is None or password is None or password2 != old_password or password == '':
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Error!&lt;/h1&gt;&lt;a href='/'&gt;Home&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;"
    else:
        if password == password2 and password == old_password:
            hashed_password = old_password
        else:
            hashed_password = hashlib.sha512(password.encode('utf-8')).hexdigest()
        file = open(config_dir + "config", "w", encoding="utf-8")
        file.write("siteTitle:" + site_title + "\npassword:" + hashed_password)
        file.close()
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                 directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;config file saved&lt;/h1&gt;&lt;a href='/'&gt;Home&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
@app.route('/savePage', methods=['POST'])
def savePage():
    """save all pages function"""
    page_content = request.form['page_content']
    # when element_format : "html", need to remove the annoying comment to prevent brython exec
    page_content = page_content.replace('// &lt;![CDATA[', '')
    page_content = page_content.replace('// ]]&gt;', '')
    # check if administrator
    if not isAdmin():
        return redirect("/login")
    if page_content is None:
        return error_log("no content to save!")
    # 在插入新頁面資料前, 先複製 content.htm 一分到 content_backup.htm
    shutil.copy2(config_dir + "content.htm", config_dir + "content_backup.htm")
    # in Windows client operator, to avoid textarea add extra \n
    # fix list object has no attribute "replace"
    page_content = page_content.replace("\n","")
    #page_content =  [w.replace('\n', '') for w in page_content]
    with open(config_dir + "content.htm", "w", encoding="utf-8") as f:
        f.write(page_content)
    return redirect("/edit_page")
 
 
# use head title to search page content
'''
# search_content(head, page, search)
# 從 head 與 page 數列中, 以 search 關鍵字進行查詢
# 原先傳回與 search 關鍵字頁面對應的頁面內容
# 現在則傳回多重的頁面次序與頁面內容數列
find = lambda searchList, elem: [[i for i, x in enumerate(searchList) if x == e] for e in elem]
head = ["標題一","標題二","標題三","標題一","標題四","標題五"]
search_result = find(head,["標題一"])[0]
page_order = []
page_content = []
for i in range(len(search_result)):
    # 印出次序
    page_order.append(search_result[i])
    # 標題為 head[search_result[i]]
    #  頁面內容則為 page[search_result[i]]
    page_content.append(page[search_result[i]])
    # 從 page[次序] 印出頁面內容
# 準備傳回 page_order 與 page_content 等兩個數列
'''
 
 
def search_content(head, page, search):
    """search content"""
    ''' 舊內容
    return page[head.index(search)]
    '''
    find = lambda searchList, elem: [[i for i, x in enumerate(searchList) if x == e] for e in elem]
    search_result = find(head, [search])[0]
    page_order = []
    page_content = []
    for i in range(len(search_result)):
        # 印出次序
        page_order.append(search_result[i])
        # 標題為 head[search_result[i]]
        #  頁面內容則為 page[search_result[i]]
        page_content.append(page[search_result[i]])
        # 從 page[次序] 印出頁面內容
    # 準備傳回 page_order 與 page_content 等兩個數列
    return page_order, page_content
 
 
@app.route('/search_form', defaults={'edit': 1})
@app.route('/search_form/&lt;path:edit&gt;')
def search_form(edit):
    """form of keyword search"""
    if isAdmin():
        head, level, page = parse_content()
        directory = render_menu(head, level, page)
        return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                 directory + "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Search&lt;/h1&gt; \
                 &lt;form method='post' action='doSearch'&gt; \
                 keywords:&lt;input type='text' name='keyword'&gt; \
                 &lt;input type='submit' value='search'&gt;&lt;/form&gt; \
                 &lt;/section&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"
    else:
        return redirect("/login")
 
 
# setup static directory
@app.route('/static/&lt;path:path&gt;')
def send_file(path):
    """send file function"""
    return app.send_static_file(static_dir + path)
 
 
# setup static directory
#@app.route('/images/&lt;path:path&gt;')
@app.route('/images/&lt;path:path&gt;')
def send_images(path):
    """send image files"""
    return send_from_directory(_curdir + "/images/", path)
 
 
# setup static directory
@app.route('/static/')
def send_static():
    """send static files"""
    return app.send_static_file('index.html')
 
 
# set_admin_css for administrator
def set_admin_css():
    """set css for admin"""
    outstring = '''&lt;!doctype html&gt;
&lt;html&gt;&lt;head&gt;
&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;title&gt;''' + init.Init.site_title + '''&lt;/title&gt; \
&lt;link rel="stylesheet" type="text/css" href="/static/cmsimply.css"&gt;
''' + syntaxhighlight()
 
    outstring += '''
&lt;script src="./../static/jquery.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
$(function(){
    $("ul.topmenu&gt; li:has(ul) &gt; a").append('&lt;div class="arrow-right"&gt;&lt;/div&gt;');
    $("ul.topmenu &gt; li ul li:has(ul) &gt; a").append('&lt;div class="arrow-right"&gt;&lt;/div&gt;');
});
&lt;/script&gt;
'''
    # SSL for uwsgi operation
    if uwsgi:
        outstring += '''
&lt;script type="text/javascript"&gt;
if ((location.href.search(/http:/) != -1) &amp;&amp; (location.href.search(/login/) != -1)) \
window.location= 'https://' + location.host + location.pathname + location.search;
&lt;/script&gt;
'''
    site_title, password = parse_config()
    outstring += '''
&lt;/head&gt;&lt;header&gt;&lt;h1&gt;''' + site_title + '''&lt;/h1&gt; \
&lt;confmenu&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="/"&gt;Home&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/sitemap"&gt;SiteMap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/edit_page"&gt;Edit All&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="''' + str(request.url) + '''/1"&gt;Edit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/edit_config"&gt;Config&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/search_form"&gt;Search&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/imageuploadform"&gt;Image Upload&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/image_list"&gt;Image List&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/fileuploadform"&gt;File Upload&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/download_list"&gt;File List&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/logout"&gt;Logout&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/generate_pages"&gt;generate_pages&lt;/a&gt;&lt;/li&gt;
'''
    outstring += '''
&lt;/ul&gt;
&lt;/confmenu&gt;&lt;/header&gt;
'''
    return outstring
 
 
def set_css():
    """set css for dynamic site"""
    outstring = '''&lt;!doctype html&gt;
&lt;html&gt;&lt;head&gt;
&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;title&gt;''' + init.Init.site_title + '''&lt;/title&gt; \
&lt;link rel="stylesheet" type="text/css" href="/static/cmsimply.css"&gt;
&lt;link rel="shortcut icon" href="/static/favicons.png"&gt;
''' + syntaxhighlight()
 
    outstring += '''
&lt;script src="./../static/jquery.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
$(function(){
    $("ul.topmenu&gt; li:has(ul) &gt; a").append('&lt;div class="arrow-right"&gt;&lt;/div&gt;');
    $("ul.topmenu &gt; li ul li:has(ul) &gt; a").append('&lt;div class="arrow-right"&gt;&lt;/div&gt;');
});
&lt;/script&gt;
'''
    if uwsgi:
        outstring += '''
&lt;script type="text/javascript"&gt;
if ((location.href.search(/http:/) != -1) &amp;&amp; (location.href.search(/login/) != -1)) \
window.location= 'https://' + location.host + location.pathname + location.search;
&lt;/script&gt;
'''
    site_title, password = parse_config()
    outstring += '''
&lt;/head&gt;&lt;header&gt;&lt;h1&gt;''' + site_title + '''&lt;/h1&gt; \
&lt;confmenu&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="/"&gt;Home&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/sitemap"&gt;Site Map&lt;/a&gt;&lt;/li&gt;
'''
    if isAdmin():
        outstring += '''
&lt;li&gt;&lt;a href="/edit_page"&gt;Edit All&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="''' + str(request.url) + '''/1"&gt;Edit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/edit_config"&gt;Config&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/search_form"&gt;Search&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/imageuploadform"&gt;image upload&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/image_list"&gt;image list&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/fileuploadform"&gt;file upload&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/download_list"&gt;file list&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/logout"&gt;logout&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/generate_pages"&gt;generate_pages&lt;/a&gt;&lt;/li&gt;
'''
    else:
        outstring += '''
&lt;li&gt;&lt;a href="/login"&gt;login&lt;/a&gt;&lt;/li&gt;
'''
    outstring += '''
&lt;/ul&gt;
&lt;/confmenu&gt;&lt;/header&gt;
'''
    return outstring
 
 
def set_css2():
    """set css for static site"""
    static_head = '''
        &lt;head&gt;
        &lt;title&gt;''' + init.Init.site_title + '''&lt;/title&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;
        &lt;link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700,900" rel="stylesheet"&gt;
        &lt;link rel="stylesheet" href="./../static/chimper/fonts/icomoon/style.css"&gt;
        &lt;link rel="stylesheet" href="./../static/chimper/css/bootstrap.min.css"&gt;
        &lt;link rel="stylesheet" href="./../static/chimper/css/magnific-popup.css"&gt;
        &lt;link rel="stylesheet" href="./../static/chimper/css/jquery-ui.css"&gt;
        &lt;link rel="stylesheet" href="./../static/chimper/css/owl.carousel.min.css"&gt;
        &lt;link rel="stylesheet" href="./../static/chimper/css/owl.theme.default.min.css"&gt;
        &lt;link rel="stylesheet" href="./../static/chimper/css/bootstrap-datepicker.css"&gt;
        &lt;link rel="stylesheet" href="./../static/chimper/fonts/flaticon/font/flaticon.css"&gt;
        &lt;link rel="stylesheet" href="./../static/chimper/css/aos.css"&gt;
        &lt;link rel="stylesheet" href="./../static/chimper/css/style.css"&gt;
        &lt;link rel="shortcut icon" href="./../static/favicons.png"&gt;
         
        &lt;style type='text/css'&gt;
            .site-section {
            background-color: #FFFF;
            padding: 40px 40px;
            }
            body &gt; div &gt; div.dropdown.open {
                display: block;
            }
        &lt;/style&gt;
    '''
    outstring = '''&lt;!DOCTYPE html&gt;&lt;html&gt;''' + static_head + '''
        &lt;!-- &lt;script src="./../static/jquery.js"&gt;&lt;/script&gt; --&gt;
        &lt;!-- &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"&gt;&lt;/script&gt; --&gt;
        &lt;script src="../static/chimper/js/jquery-3.3.1.min.js"&gt;&lt;/script&gt;
        &lt;link rel="stylesheet" href="./../static/tipuesearch/css/normalize.min.css"&gt;
        &lt;script src="./../static/tipuesearch/tipuesearch_set.js"&gt;&lt;/script&gt;
        &lt;script src="tipuesearch_content.js"&gt;&lt;/script&gt;
        &lt;link rel="stylesheet" href="./../static/tipuesearch/css/tipuesearch.css"&gt;
        &lt;script src="./../static/tipuesearch/tipuesearch.js"&gt;&lt;/script&gt;
        &lt;script&gt;
            /* original tipuesearch
            $(document).ready(function() {
                 $('#tipue_search_input').tipuesearch();
            });
            */
            // customed doSearch
            function doSearch() {
                $('#tipue_search_input').tipuesearch({
                    newWindow: true, 
                    minimumLength: 2,
                    wholeWords: false, // for search 中文
                });
            }
            $(document).ready(doSearch);
        &lt;/script&gt;
        ''' + syntaxhighlight2()
 
    site_title, password = parse_config()
    if uwsgi:
        outstring += '''
&lt;script type="text/javascript"&gt;
if ((location.href.search(/http:/) != -1) &amp;&amp; (location.href.search(/login/) != -1)) \
window.location= 'https://' + location.host + location.pathname + location.search;
&lt;/script&gt;&lt;/head&gt;&lt;body&gt;
'''
    else:
        outstring += '''
&lt;/head&gt;
&lt;body&gt;
'''
    return outstring
 
 
def set_footer():
    """footer for page"""
    return "&lt;footer&gt; \
        &lt;a href='/edit_page'&gt;Edit All&lt;/a&gt;| \
        &lt;a href='" + str(request.url) + "/1'&gt;Edit&lt;/a&gt;| \
        &lt;a href='edit_config'&gt;Config&lt;/a&gt; \
        &lt;a href='login'&gt;login&lt;/a&gt;| \
        &lt;a href='logout'&gt;logout&lt;/a&gt; \
        &lt;br /&gt;Powered by &lt;a href='http://cmsimple.cycu.org'&gt;CMSimply&lt;/a&gt; \
        &lt;/footer&gt; \
        &lt;/body&gt;&lt;/html&gt;"
@app.route('/sitemap', defaults={'edit': 1})
@app.route('/sitemap/&lt;path:edit&gt;')
def sitemap(edit):
    """sitemap for dynamic site"""
    head, level, page = parse_content()
    directory = render_menu(head, level, page)
    sitemap = render_menu(head, level, page, sitemap=1)
    return set_css() + "&lt;div class='container'&gt;&lt;nav&gt;" + directory + \
             "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Site Map&lt;/h1&gt;" + sitemap + \
             "&lt;/section&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"
def sitemap2(head):
    """sitemap for static content generation"""
    edit = 0
    not_used_head, level, page = parse_content()
    directory = render_menu2(head, level, page)
    # 先改為使用 render_menu3 而非 render_menu2
    sitemap = render_menu3(head, level, page, sitemap=1)
    # add tipue search id
    return set_css2() + "&lt;div class='container'&gt;&lt;nav&gt;" + directory + \
             "&lt;/nav&gt;&lt;section&gt;&lt;h1&gt;Site Map&lt;/h1&gt;&lt;div id=\"tipue_search_content\"&gt;&lt;/div&gt;" + sitemap + \
             "&lt;/section&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"
 
 
def sizeof_fmt(num):
    """size formate"""
    for x in ['bytes','KB','MB','GB']:
        if num &lt; 1024.0:
            return "%3.1f%s" % (num, x)
        num /= 1024.0
    return "%3.1f%s" % (num, 'TB')
@app.route('/ssavePage', methods=['POST'])
def ssavePage():
    """seperate save page function"""
    page_content = request.form['page_content']
    # when element_format : "html", need to remove the annoying comment to prevent brython exec
    page_content = page_content.replace('// &lt;![CDATA[', '')
    page_content = page_content.replace('// ]]&gt;', '')
    page_order = request.form['page_order']
    if not isAdmin():
        return redirect("/login")
    if page_content is None:
        return error_log("no content to save!")
    # 請注意, 若啟用 fullpage plugin 這裡的 page_content tinymce4 會自動加上 html 頭尾標註
    page_content = page_content.replace("\n","")
    head, level, page = parse_content()
    original_head_title = head[int(page_order)]
    # 在插入新頁面資料前, 先複製 content.htm 一分到 content_backup.htm
    shutil.copy2(config_dir + "content.htm", config_dir + "content_backup.htm")
    file = open(config_dir + "content.htm", "w", encoding="utf-8")
    for index in range(len(head)):
        if index == int(page_order):
            file.write(page_content)
        else:
            file.write("&lt;h"+str(level[index])+ "&gt;" + str(head[index]) + "&lt;/h" + \
                          str(level[index])+"&gt;"+str(page[index]))
    file.close()
    # if every ssavePage generate_pages needed
    #generate_pages()
 
    # if head[int(page_order)] still existed and equal original_head_title, go back to origin edit status, otherwise go to "/"
    # here the content is modified, we need to parse the new page_content again
    head, level, page = parse_content()
    # for debug
    # print(original_head_title, head[int(page_order)])
    # 嘗試避免因最後一個標題刪除儲存後產生 internal error 問題
    if original_head_title is None:
        return redirect("/")
    try:
        if original_head_title == head[int(page_order)]:
            #edit_url = "/get_page/" + urllib.parse.quote_plus(head[int(page_order)]) + "&amp;edit=1"
            #edit_url = "/get_page/" + urllib.parse.quote_plus(original_head_title) + "/1"
            edit_url = "/get_page/" + original_head_title + "/1"
            return redirect(edit_url)
        else:
            return redirect("/")
    except:
        return redirect("/")
 
 
def syntaxhighlight():
    return '''
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shCore.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJScript.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJava.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPython.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushSql.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushXml.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPhp.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushLua.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCpp.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCss.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCSharp.js"&gt;&lt;/script&gt;
&lt;link type="text/css" rel="stylesheet" href="/static/syntaxhighlighter/css/shCoreDefault.css"/&gt;
&lt;script type="text/javascript"&gt;SyntaxHighlighter.all();&lt;/script&gt;
 
&lt;!-- for LaTeX equations 暫時不用
    &lt;script src="https://scrum-3.github.io/web/math/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;
    init_mathjax = function() {
        if (window.MathJax) {
            // MathJax loaded
            MathJax.Hub.Config({
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\\\(","\\\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\\\[","\\\\]"] ]
                },
                displayAlign: 'left', // Change this to 'center' to center equations.
                "HTML-CSS": {
                    styles: {'.MathJax_Display': {"margin": 0}}
                }
            });
            MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
        }
    }
    init_mathjax();
    &lt;/script&gt;
 --&gt;
 &lt;!-- 暫時不用
&lt;script src="./../static/fengari-web.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/Cango-13v08-min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/CangoAxes-4v01-min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/gearUtils-05.js"&gt;&lt;/script&gt;
--&gt;
&lt;!-- for Brython 暫時不用
&lt;script src="https://scrum-3.github.io/web/brython/brython.js"&gt;&lt;/script&gt;
&lt;script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"&gt;&lt;/script&gt;
--&gt;
'''
 
 
 
def syntaxhighlight2():
    return '''
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shCore.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJScript.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJava.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPython.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushSql.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushXml.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPhp.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushLua.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCpp.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCss.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCSharp.js"&gt;&lt;/script&gt;
&lt;link type="text/css" rel="stylesheet" href="./../static/syntaxhighlighter/css/shCoreDefault.css"/&gt;
&lt;script type="text/javascript"&gt;SyntaxHighlighter.all();&lt;/script&gt;
 
&lt;!-- for LaTeX equations 暫時不用
&lt;script src="https://scrum-3.github.io/web/math/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\\\(","\\\\)"] ],
                displayMath: [ ['$$','$$'], ["\\\\[","\\\\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
&lt;/script&gt;
--&gt;
&lt;!-- 暫時不用
&lt;script src="./../static/fengari-web.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/Cango-13v08-min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/CangoAxes-4v01-min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="./../static/gearUtils-05.js"&gt;&lt;/script&gt;
--&gt;
&lt;!-- for Brython 暫時不用
&lt;script src="https://scrum-3.github.io/web/brython/brython.js"&gt;&lt;/script&gt;
&lt;script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"&gt;&lt;/script&gt;
--&gt;
'''
 
 
def tinymce_editor(menu_input=None, editor_content=None, page_order=None):
    sitecontent =file_get_contents(config_dir + "content.htm")
    editor = set_admin_css() + editorhead() + '''&lt;/head&gt;''' + editorfoot()
    # edit all pages
    if page_order is None:
        outstring = editor + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                        menu_input + "&lt;/nav&gt;&lt;section&gt;&lt;form method='post' action='savePage'&gt; \
                        &lt;textarea class='simply-editor' name='page_content' cols='50' rows='15'&gt;" +  \
                        editor_content + "&lt;/textarea&gt;&lt;input type='submit' value='save'&gt; \
                        &lt;/form&gt;&lt;/section&gt;&lt;/body&gt;&lt;/html&gt;"
    else:
        # add viewpage button wilie single page editing
        head, level, page = parse_content()
        outstring = editor + "&lt;div class='container'&gt;&lt;nav&gt;" + \
                        menu_input+"&lt;/nav&gt;&lt;section&gt;&lt;form method='post' action='/ssavePage'&gt; \
                        &lt;textarea class='simply-editor' name='page_content' cols='50' rows='15'&gt;" + \
                        editor_content + "&lt;/textarea&gt;&lt;input type='hidden' name='page_order' value='" + \
                        str(page_order) + "'&gt;&lt;input type='submit' value='save'&gt;"
        outstring += '''&lt;input type=button onClick="location.href='/get_page/''' + \
                    head[page_order] + \
                    ''''" value='viewpage'&gt;&lt;/form&gt;&lt;/section&gt;&lt;/body&gt;&lt;/html&gt;'''
    return outstring
 
 
def unique(items):
    """make items element unique"""
    found = set([])
    keep = []
    count = {}
    for item in items:
        if item not in found:
            count[item] = 0
            found.add(item)
            keep.append(item)
        else:
            count[item] += 1
            keep.append(str(item) + "_" + str(count[item]))
    return keep
 
 
if __name__ == "__main__":
    app.run()</pre>
<p></p><h2>ROC Flag</h2>
<!-- 導入 Brython 標準程式庫 -->
<script src="/static/brython.js"></script>
<script src="/static/brython_stdlib.js"></script>
<p></p>
<!-- 啟動 Brython -->
<script>
window.onload=function(){
// 設定 data/py 為共用程式路徑
brython({debug:1, pythonpath:['./../data/py']});
}
</script>
<p><canvas height="400" id="plotarea" width="600"></canvas></p>
<script type="text/python">
# 導入 doc
from browser import document as doc
import math

# 準備繪圖畫布
canvas = doc["plotarea"]
ctx = canvas.getContext("2d")
# 進行座標轉換, x 軸不變, y 軸反向且移動 canvas.height 單位光點
# ctx.setTransform(1, 0, 0, -1, 0, canvas.height)
# 以下採用 canvas 原始座標繪圖
flag_w = canvas.width
flag_h = canvas.height
circle_x = flag_w/4
circle_y = flag_h/4
# 先畫滿地紅
ctx.fillStyle='rgb(255, 0, 0)'
ctx.fillRect(0,0,flag_w,flag_h)
# 再畫青天
ctx.fillStyle='rgb(0, 0, 150)'
ctx.fillRect(0,0,flag_w/2,flag_h/2)
# 畫十二道光芒白日
ctx.beginPath()
star_radius = flag_w/8
angle = 0
for i in range(24):
    angle += 5*math.pi*2/12
    toX = circle_x + math.cos(angle)*star_radius
    toY = circle_y + math.sin(angle)*star_radius
    # 只有 i 為 0 時移動到 toX, toY, 其餘都進行 lineTo
    if (i):
        ctx.lineTo(toX, toY)
    else:
        ctx.moveTo(toX, toY)
ctx.closePath()
# 將填色設為白色
ctx.fillStyle = '#fff'
ctx.fill()
# 白日:藍圈
ctx.beginPath()
ctx.arc(circle_x, circle_y, flag_w*17/240, 0, math.pi*2, True)
ctx.closePath()
# 填色設為藍色
ctx.fillStyle = 'rgb(0, 0, 149)'
ctx.fill()
# 白日:白心
ctx.beginPath()
ctx.arc(circle_x, circle_y, flag_w/16, 0, math.pi*2, True)
ctx.closePath()
# 填色設為白色
ctx.fillStyle = '#fff'
ctx.fill()
</script>
<!-- 導入 Brython 標準程式庫 -->
<script src="/static/brython.js"></script>
<script src="/static/brython_stdlib.js"></script>
<p></p>
<!-- 啟動 Brython -->
<script>
window.onload=function(){
// 設定 data/py 為共用程式路徑
brython({debug:1, pythonpath:['./../data/py']});
}
</script>
<p><canvas height="400" id="plotarea2" width="600"></canvas></p>
<script type="text/python">
# 導入 doc
from browser import document as doc
import math

# 準備繪圖畫布
canvas = doc["plotarea2"]
ctx = canvas.getContext("2d")
# 進行座標轉換, x 軸不變, y 軸反向且移動 canvas.height 單位光點
# ctx.setTransform(1, 0, 0, -1, 0, canvas.height)
# 以下採用 canvas 原始座標繪圖
flag_w = canvas.width
flag_h = canvas.height
circle_x = flag_w/4
circle_y = flag_h/4
# 先畫滿地紅
ctx.fillStyle='rgb(0, 255, 0)'
ctx.fillRect(0,0,flag_w,flag_h)
# 再畫青天
ctx.fillStyle='rgb(0, 0, 150)'
ctx.fillRect(0,0,flag_w/2,flag_h/2)
# 畫十二道光芒白日
ctx.beginPath()
star_radius = flag_w/8
angle = 0
for i in range(24):
    angle += 5*math.pi*2/12
    toX = circle_x + math.cos(angle)*star_radius
    toY = circle_y + math.sin(angle)*star_radius
    # 只有 i 為 0 時移動到 toX, toY, 其餘都進行 lineTo
    if (i):
        ctx.lineTo(toX, toY)
    else:
        ctx.moveTo(toX, toY)
ctx.closePath()
# 將填色設為白色
ctx.fillStyle = '#fff'
ctx.fill()
# 白日:藍圈
ctx.beginPath()
ctx.arc(circle_x, circle_y, flag_w*17/240, 0, math.pi*2, True)
ctx.closePath()
# 填色設為藍色
ctx.fillStyle = 'rgb(0, 0, 149)'
ctx.fill()
# 白日:白心
ctx.beginPath()
ctx.arc(circle_x, circle_y, flag_w/16, 0, math.pi*2, True)
ctx.closePath()
# 填色設為白色
ctx.fillStyle = '#fff'
ctx.fill()
</script>
<p><canvas height="400" id="plotarea3" width="600"></canvas></p>
<script type="text/python">
# 導入 doc
from browser import document as doc
import math

# 準備繪圖畫布
canvas = doc["plotarea3"]
ctx = canvas.getContext("2d")
# 進行座標轉換, x 軸不變, y 軸反向且移動 canvas.height 單位光點
# ctx.setTransform(1, 0, 0, -1, 0, canvas.height)
# 以下採用 canvas 原始座標繪圖
flag_w = canvas.width
flag_h = canvas.height
circle_x = flag_w/2
circle_y = flag_h/2
# 先畫滿地紅
ctx.fillStyle='rgb(255, 0, 0)'
ctx.fillRect(300,0,flag_w,flag_h)
# 再畫青天
ctx.fillStyle='rgb(0, 0, 150)'
ctx.fillRect(0,0,flag_w/2,flag_h)
# 畫十二道光芒白日
ctx.beginPath()
star_radius = flag_w/8
angle = 0
for i in range(24):
    angle += 5*math.pi*2/12
    toX = circle_x + math.cos(angle)*star_radius
    toY = circle_y + math.sin(angle)*star_radius
    # 只有 i 為 0 時移動到 toX, toY, 其餘都進行 lineTo
    if (i):
        ctx.lineTo(toX, toY)
    else:
        ctx.moveTo(toX, toY)
ctx.closePath()
# 將填色設為白色
ctx.fillStyle = '#fff'
ctx.fill()
# 白日:藍圈
ctx.beginPath()
ctx.arc(circle_x, circle_y, flag_w*17/240, 0, math.pi*2, True)
ctx.closePath()
# 填色設為藍色
ctx.fillStyle = 'rgb(0, 0, 149)'
ctx.fill()
# 白日:白心
ctx.beginPath()
ctx.arc(circle_x, circle_y, flag_w/16, 0, math.pi*2, True)
ctx.closePath()
# 填色設為白色
ctx.fillStyle = '#fff'
ctx.fill()
</script><h3>程式碼</h3>
<p><strong><span style="color: #ff0000;">國旗程式碼:</span></strong></p>
<pre class="brush:html;auto-links:false;toolbar:false" contenteditable="false">&lt;!-- 導入 Brython 標準程式庫 --&gt;
&lt;script src="./../static/brython.js"&gt;&lt;/script&gt;
&lt;script src="./../static/brython_stdlib.js"&gt;&lt;/script&gt;
&lt;p&gt;&lt;/p&gt;
&lt;!-- 啟動 Brython --&gt;
&lt;script&gt;// &lt;![CDATA[
window.onload=function(){
// 設定 data/py 為共用程式路徑
brython({debug:1, pythonpath:['./../data/py']});
}
// ]]&gt;&lt;/script&gt;
&lt;p&gt;&lt;canvas height="400" id="plotarea" width="600"&gt;&lt;/canvas&gt;&lt;/p&gt;
&lt;script type="text/python"&gt;// &lt;![CDATA[
# 導入 doc
from browser import document as doc
import math
 
# 準備繪圖畫布
canvas = doc["plotarea"]
ctx = canvas.getContext("2d")
# 進行座標轉換, x 軸不變, y 軸反向且移動 canvas.height 單位光點
# ctx.setTransform(1, 0, 0, -1, 0, canvas.height)
# 以下採用 canvas 原始座標繪圖
flag_w = canvas.width
flag_h = canvas.height
circle_x = flag_w/4
circle_y = flag_h/4
# 先畫滿地紅
ctx.fillStyle='rgb(255, 0, 0)'
ctx.fillRect(0,0,flag_w,flag_h)
# 再畫青天
ctx.fillStyle='rgb(0, 0, 150)'
ctx.fillRect(0,0,flag_w/2,flag_h/2)
# 畫十二道光芒白日
ctx.beginPath()
star_radius = flag_w/8
angle = 0
for i in range(24):
    angle += 5*math.pi*2/12
    toX = circle_x + math.cos(angle)*star_radius
    toY = circle_y + math.sin(angle)*star_radius
    # 只有 i 為 0 時移動到 toX, toY, 其餘都進行 lineTo
    if (i):
        ctx.lineTo(toX, toY)
    else:
        ctx.moveTo(toX, toY)
ctx.closePath()
# 將填色設為白色
ctx.fillStyle = '#fff'
ctx.fill()
# 白日:藍圈
ctx.beginPath()
ctx.arc(circle_x, circle_y, flag_w*17/240, 0, math.pi*2, True)
ctx.closePath()
# 填色設為藍色
ctx.fillStyle = 'rgb(0, 0, 149)'
ctx.fill()
# 白日:白心
ctx.beginPath()
ctx.arc(circle_x, circle_y, flag_w/16, 0, math.pi*2, True)
ctx.closePath()
# 填色設為白色
ctx.fillStyle = '#fff'
ctx.fill()
// ]]&gt;&lt;/script&gt;</pre>
<p></p><h1>W15</h1>
<h2>VM虛擬主機</h2>
<p>1.到ubuntu網站下載Sever</p>
<p>ubuntu網站:<a href="https://www.ubuntu.com/">https://www.ubuntu.com/</a></p>
<p><img alt="" height="247" src="/images/a.png" width="534"/></p>
<p><img alt="" height="153" src="/images/b.png" width="566"/></p>
<p><span>2.打開VM--&gt;創建一台虛擬主機</span></p>
<p><span><img alt="" height="306" src="/images/c.png" width="544"/></span></p>
<p>2.設定主機名稱及分配記憶體(不建議低於2048MB)</p>
<p><img alt="" height="464" src="/images/d.png" width="514"/></p>
<p>3.Flie size通常都使用500GB,硬碟檔類型使用VMDK之後轉實體比較方便</p>
<p>基本上我們的硬碟分配會使用動態分配(Dynamically allocated)用多少拿多少</p>
<p>如果使用固定大小會很吃電腦的硬碟容量</p>
<p><img alt="" height="452" src="/images/e.png" width="496"/></p>
<p>4.設定完打開虛擬主機---&gt;載入檔案</p>
<p><img alt="" height="436" src="/images/VirtualBox_D5dsuKgjbK.png" width="505"/></p>
<p>5.按Start--&gt;設定</p>
<p>選擇English語言</p>
<p><img alt="" height="422" src="/images/vm1.png" width="503"/></p>
<p>這裡不用改直接Done</p>
<p><img alt="" height="421" src="/images/vm2.png" width="501"/></p>
<p>這裡選第一個安裝,其他兩個是多主機雲端協同用的</p>
<p><img alt="" height="419" src="/images/vm3.png" width="498"/></p>
<p>這裡是網路設定,現在是以NAT,就可以直接下一步了</p>
<p><img alt="" height="423" src="/images/vm4.png" width="503"/></p>
<p>這裡是設定proxy,打上學校使用的proxy      <a href="http://140.130.17.4:3128">http://140.130.17.4:3128</a></p>
<p>若不使用可留白</p>
<p><img alt="" height="424" src="/images/vm5.png" width="504"/>buntu的鏡像網址,保留預設就好</p>
<p><img alt="" height="431" src="/images/6.png" width="512"/></p>
<p>這裡是要分割硬碟,並格式化,這裡選第一個使用整顆硬碟來格式化</p>
<p><img alt="" height="423" src="/images/7-1.png" width="503"/></p>
<p>這裡是要安裝的硬碟</p>
<p><img alt="" height="422" src="/images/7-3.1.png" width="502"/></p>
<p>確認之後就可以開始格式化了</p>
<p><img alt="" height="422" src="/images/7-6.png" width="501"/></p>
<p><img alt="" height="419" src="/images/7-4.png" width="499"/></p>
<p>再來要設定名稱和密碼</p>
<p><img alt="" height="422" src="/images/7-2.png" width="503"/></p>
<p>這是問你要不要使用SSH key,打勾Install OpenSSH sever,就可以下一步了</p>
<p><img alt="" height="420" src="/images/7-3.png" width="500"/></p>
<p>這裡直接下一步</p>
<p><img alt="" height="421" src="/images/7-5.png" width="500"/></p>
<p>等待安裝完就完成了</p>
<p><img alt="" height="420" src="/images/11.png" width="499"/></p>
<p>安裝完選擇Reboot Now就可以使用了</p>
<p><img alt="" height="419" src="/images/12.png" width="498"/></p>
<p>剛開始進入它會叫你輸入名稱和密碼,因為使用sudo都需要登入</p>
<p>如果要關機要打指令<span style="color: #ff0000;">sudo halt<span style="color: #0000ff;">   這是關機並沒有關電源</span></span></p>
<p><span color="#000000" style="color: #000000;">使用<span style="color: #ff0000;">sudo shutdown -h now   <span style="color: #0000ff;">關機並關電源</span></span></span></p>
<h3>nginx 安裝設定</h3>
<p><span><strong>1.利用指令sudo apt install nginx 安裝 nginx WWW 伺服器</strong></span></p>
<p><span><strong><span><img alt="" height="420" src="https://50733141.github.io/2019wcmj/images/%E4%BB%A5%E6%8C%87%E4%BB%A4%E5%AE%89%E8%A3%9Dnginx.png" width="500"/></span></strong></span></p>
<p><strong><span>2. 利用<span>ifconfig</span>指令查詢 Ubuntu 伺服器的 IP,在網頁裡輸入網址，測試 nginx 伺服器是否可以連線</span></strong></p>
<p><strong><span><img alt="" height="420" src="https://50733141.github.io/2019wcmj/images/ifconfig.png" width="500"/></span></strong></p>
<p><strong><span><img alt="" height="361" src="https://50733141.github.io/2019wcmj/images/vituralbox%E9%96%8B%E5%95%9F%E7%B6%B2%E9%A0%81.png" width="600"/><br/></span></strong></p>
<p><strong><span>3.<span> 開啟安裝好的filezilla client ，將編輯好的 nginx 設定檔案送到 Ubuntu</span></span></strong></p>
<p><strong><span><span><img alt="" height="477" src="https://50733141.github.io/2019wcmj/images/%E5%82%B3%E9%80%81%E4%B8%89%E5%80%8B%E6%AA%94%E6%A1%88.png" width="600"/></span></span></strong></p>
<h3>FileZilla</h3>
<p><strong>FileZilla程式一種快速、可信賴的FTP用戶端以及伺服器端開放原始碼程式，具有多種特色、直覺的介面。</strong></p>
<p><span style="color: #0000ff;"><strong>下載網頁:<a href="https://portableapps.com/apps/internet/filezilla_portable">https://portableapps.com/apps/internet/filezilla_portable</a></strong></span></p>
<p>進入網頁後下載檔案並且進行安裝。</p>
<p><img alt="" height="346" src="https://50733141.github.io/2019wcmj/images/chrome_Luo4Ub5nHB.png" width="600"/></p>
<p>在檔案-站台管理員-新增站台-利用ifconfig查詢虛擬主機的ip位置後將ip新增到主機空格內，並且輸入虛擬主機使用者名稱及密碼，點選連線後即完成。</p>
<p><img alt="" height="488" src="https://50733141.github.io/2019wcmj/images/filezilla_IYGkogLrBZ.png" width="600"/></p><h2>SSL-VPN</h2>
<p>到學校電算中心有SSL-VPN服務教學</p>
<p>參考網址:<a href="https://nfucc.nfu.edu.tw/zh/download/download-network/ssl-vpn">https://nfucc.nfu.edu.tw/zh/download/download-network/ssl-vpn</a></p>
<p><span><strong>1. 首次使用須先安裝SSL VPN 程式</strong></span></p>
<p><span>1.請依您的作業系統版本下載使用者端程式：<a href="https://drive.narlabs.org.tw/navigate/s/8F663EC143514CF295FCB53B5B228956GUY">連結</a></span></p>
<p><span>2.程式下載完成後，點擊兩下開始安裝。</span><br/><span>   <img alt=" archive 3629 d5014af5" src="https://nfucc.nfu.edu.tw/images/image/-archive-3629_d5014af5.png"/></span></p>
<p><span>   </span></p>
<hr size="2" width="100%"/>
<div><span><strong>2. </strong><strong>進行身份驗證(可由Juniper Network Connect或IE，請擇一進行身分認證)</strong></span></div>
<div><span></span></div>
<div><span>2-1: Juniper Network Connect 應用程式認證</span></div>
<blockquote>
<div>
<p><span>1."點選搜尋" &gt; 輸入程式名稱為Network Connect&gt; 點擊Network Connect</span></p>
<p><span><img alt="5" src="https://nfucc.nfu.edu.tw/images/image/sslvpn/5.jpg"/></span></p>
<p><span>2.執行程式後，於"登入頁面"輸入網址 :<span> </span><a href="https://sslvpn.nfu.edu.tw/nfu">https://sslvpn9.twaren.net/nfu</a><span> </span>，後按下"執行"</span></p>
<p><span><img alt="1" src="https://nfucc.nfu.edu.tw/images/image/sslvpn/1.jpg"/></span></p>
<p><span>3.輸入使用者帳號密碼，請填入校務行政AD帳號及密碼。請完整填寫您在校務行政AD帳號以及密碼，否則國網中心找不到對象進行身份確認<span> </span></span><br/><span>！(例: 員工編號或學號@ctx10.nfu.edu.tw）</span></p>
<p><img alt="1" height="430" src="https://nfucc.nfu.edu.tw/images/1.PNG" width="472"/></p>
<p>(以下為舊版本的登入畫面)</p>
<p><span><img alt="2" src="https://nfucc.nfu.edu.tw/images/image/sslvpn/2.jpg"/></span></p>
<p></p>
<p><span>4.出現"設定控制-警告"視窗，按下"是"</span></p>
<p><span><img alt="3" src="https://nfucc.nfu.edu.tw/images/image/sslvpn/3.jpg"/></span></p>
</div>
</blockquote>
<div>
<p><span>             5.螢幕右下角顯示"已連接"，表示已成功連線。</span></p>
<p><span>             <img alt="4" src="https://nfucc.nfu.edu.tw/images/image/sslvpn/4.jpg"/></span></p>
</div>
<div><span></span></div>
<div><span>2-2: IE網認證</span></div>
<blockquote>
<div><span>1.請在IE瀏覽器上按下右鍵 使用"以系統管理員身分執行"</span></div>
<div><span>登入頁面請輸入： <a href="https://sslvpn9.twaren.net/nfu">https://sslvpn9.twaren.net/nfu</a>，按下「執行」，會出現帳號與密碼登入欄位。</span><br/><span>請填入虎尾科技大學的校務行政AD帳號及密碼，並請輸入下方驗證碼，進行身份確認。</span><br/><span><span><span>請完整填寫您在虎尾科技大學的校務行政AD帳號以及密碼</span></span>，否則國網中心找不到對象進行身份確認！</span></div>
<div><span>(例:<span><span> 員工編號或學號@ctx10.nfu.edu.tw</span></span>）</span><br/><span>填寫完畢以後按下Login登入就會開始進行身份確認，請稍後一段時間。</span></div>
<div><span></span></div>
<div><span><img alt="1" src="https://nfucc.nfu.edu.tw/images/image/sslvpn/Web/1.jpg"/></span></div>
<div><span></span></div>
<div><span><img alt="2" height="493" src="https://nfucc.nfu.edu.tw/images/image/sslvpn/Web/2.JPG" width="800"/></span></div>
<div><span></span></div>
<div><span>2.點選「開始」 </span></div>
<div><span><img alt="3" height="493" src="https://nfucc.nfu.edu.tw/images/image/sslvpn/Web/3.jpg" width="800"/></span></div>
<div><span>3.點選「是」，SSL VPN程式安裝完畢後，就會開始跟你的電腦建立連線，請稍後一段時間。</span></div>
<div>
<p><span><img alt="5" height="493" src="https://nfucc.nfu.edu.tw/images/image/sslvpn/Web/5.jpg" width="800"/></span></p>
</div>
</blockquote>
<div><hr size="2" width="100%"/></div>
<div><span><strong> </strong></span></div>
<blockquote>
<div><span> <strong>5. </strong><strong>VPN</strong><strong>連線建立完成</strong></span></div>
</blockquote>
<blockquote><span>連線建立完成後，在電腦的工作列上(桌面右下角)，會出現 Juniper Network Connect VPN Client的圖示，表示VPN連線已經成功的建立在你的電腦上了。點擊圖示兩下，即可查看連線資訊。<span>(註:指派IP:一定為120.113.100.XX)</span>。</span><br/><span>到此，您的SSL-VPN連線已經成功的建立，不管是在家裡還是出差，您的電腦就像在學校使用一般，您可以自由的使用虎尾科技大學自己擁有的網路資源。</span>
<div><span><img alt="153.png" src="https://nfucc.nfu.edu.tw/images/153.png"/></span></div>
</blockquote>
<div><hr size="2" width="100%"/></div>
<div><span><strong>6. </strong><strong>連線IP檢視</strong>(*)</span></div>
<blockquote>
<div><span>如何得知連線的 IP 究竟是什麼呢？您可透過網際網路上提供 IP 位址偵測服務的網站進行確認，例如 <a href="http://showip.net/" target="_blank" title="Show IP"><span>http://showip.net/</span></a></span></div>
<div><span><img alt="15313.png" src="https://nfucc.nfu.edu.tw/images/15313.png"/></span></div>
</blockquote><h2>校園軟體</h2>
<p>學校提供免費的軟體,可以使用學校eCare帳號進行下載</p>
<p><strong><span style="color: #ff0000;">以下可下載的軟體:</span></strong></p>
<p><span style="color: #0000ff;"><strong>1.microsoft</strong></span></p>
<p><span style="color: #0000ff;"><strong>2.<small>Antivrus Software</small></strong></span></p>
<p><span style="color: #0000ff;"><strong>3.<small>MATLAB Software</small></strong></span></p>
<p><span style="color: #0000ff;"><strong>4.AUTODESK</strong></span></p>
<p><span style="color: #0000ff;"><strong>5.<small>Free Software</small></strong></span></p>
<p>相關資料源自電算中心網址:<a href="https://nfucc.nfu.edu.tw/zh/download">https://nfucc.nfu.edu.tw/zh/download</a></p><h3>下載教學</h3>
<p>1.前往學校電算中心網站-下載專區</p>
<p>網址:<a href="https://nfucc.nfu.edu.tw/zh/download">https://nfucc.nfu.edu.tw/zh/download</a></p>
<p>點選校園授權軟體下載專區</p>
<p><img alt="" height="255" src="/images/1.png" width="550"/></p>
<p>2.登入校務eCare帳號</p>
<p><img alt="" height="255" src="/images/2.png" width="551"/></p>
<p>3.點選想要下載的軟體(範例:Microsoft)</p>
<p><img alt="" height="253" src="/images/3.png" width="548"/></p>
<p>4.選取軟體</p>
<p><img alt="" height="253" src="/images/4.png" width="548"/></p>
<p>5.選取下載版本即可完成</p>
<p><img alt="" height="253" src="/images/5.png" width="547"/></p>
<h1>期末報告及影片</h1>
<p>1.錄製至多5分鐘的期末報告影片,以學號的帳戶登入YouTube上傳,</p>
<p>並改標題:</p>
<p><span>國立虎尾科技大學 - 精密機械工程科 - 網際內容管理期末報告 - 學號 - 姓名</span></p>
<p>2.由github倉儲更新歷程,呈現各週進度說明</p>
<p>3.上台報告</p>
<p><iframe allowfullscreen="allowfullscreen" height="314" src="//www.youtube.com/embed/JQlpdY-1D6Y" width="560"></iframe></p>
<p></p>